<div class="page-layout" [ngClass]="{ 'sidebar-collapsed': sidebarCollapsed }">
  <div class="alert-container" *ngIf="alertMessage">
    <div class="alert">
      {{ alertMessage }}
    </div>
  </div>
  <div class="sidebar">
    <app-sidebar (collapseChange)="onSidebarCollapse($event)"></app-sidebar>
  </div>
  <div class="main-content">
    <div class="dashboard-header">
      <h1 class="title">Archive</h1>
    </div>
    <div class="table-wrapper">
      <div class="button-container">
        <button class="upload-button" (click)="openUploadModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M7.49967 14.167V9.16699L5.83301 10.8337" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7.5 9.16699L9.16667 10.8337" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.3337 8.33366V12.5003C18.3337 16.667 16.667 18.3337 12.5003 18.3337H7.50033C3.33366 18.3337 1.66699 16.667 1.66699 12.5003V7.50033C1.66699 3.33366 3.33366 1.66699 7.50033 1.66699H11.667" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.3337 8.33366H15.0003C12.5003 8.33366 11.667 7.50033 11.667 5.00033V1.66699L18.3337 8.33366Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Upload File
        </button>
      </div>

      <!-- Empty State -->
      <div class="upload-area" *ngIf="files.length === 0"
        [class.dragging]="isDragging"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onFileDropped($event)"
      >
        <div class="upload-content">
          <div class="upp">
            <div class="illustration">
              <svg width="200" height="200" viewBox="0 0 400 400">
                <!-- File stack illustration -->
                <g class="file-stack">
                  <rect
                    x="100"
                    y="100"
                    width="160"
                    height="200"
                    fill="#f8f9fa"
                    stroke="#e2e8f0"
                    stroke-width="2"
                  />
                  <rect
                    x="120"
                    y="80"
                    width="160"
                    height="200"
                    fill="#f8f9fa"
                    stroke="#e2e8f0"
                    stroke-width="2"
                  />
                  <rect
                    x="140"
                    y="60"
                    width="160"
                    height="200"
                    fill="#f8f9fa"
                    stroke="#e2e8f0"
                    stroke-width="2"
                  />
                </g>
                <!-- Character -->
                <g class="character" transform="translate(200, 160)">
                  <circle cx="0" cy="0" r="20" fill="#6366f1" />
                  <path
                    d="M -10 30 Q 0 60 10 30"
                    stroke="#6366f1"
                    fill="none"
                    stroke-width="4"
                  />
                  <line
                    x1="0"
                    y1="20"
                    x2="0"
                    y2="50"
                    stroke="#6366f1"
                    stroke-width="4"
                  />
                  <line
                    x1="-20"
                    y1="40"
                    x2="0"
                    y2="20"
                    stroke="#6366f1"
                    stroke-width="4"
                  />
                  <line
                    x1="20"
                    y1="40"
                    x2="0"
                    y2="20"
                    stroke="#6366f1"
                    stroke-width="4"
                  />
                </g>
              </svg>
            </div>
          </div>
          <h3>Files Will Appear Here</h3>
          <p>Once you upload files, they'll be displayed here for easy access and management.</p>
        </div>
      </div>

      <!-- Table View - Only shown when there are files -->
      <div class="table-container" *ngIf="files.length > 0">
        <table>
          <thead>
            <tr>
              <th>File Name</th>
              <th>Uploaded By</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let file of files">
              <td>
                <div class="file-info">
                  <!-- <span class="file-name-link" (click)="downloadFile(file)">{{ file.name }}</span> -->
                </div>
              </td>
              <td>
                <div class="user-info">
                  <div class="user-avatar">
                    {{ file.uploadedBy.avatar }}
                  </div>
                  <span>{{ file.uploadedBy.name }}</span>
                </div>
              </td>
              <td>{{ file.uploadDate | date:'mediumDate' }}</td>
              <td class="action-cell">
                <button class="action-btn" (click)="editFile(file)">
                  <img src="assets/Images/Icons/edit.svg" alt="Edit">
                </button>
                <button class="action-btn delete" (click)="deleteFile(file)">
                  <img src="assets/Images/Icons/trash.svg" alt="Delete" class="action-img">
                </button>
                <!-- <button class="action-btn" (click)="viewFile(file)" title="View">
                  <img src="assets/Images/Icons/eye.svg" alt="View">
                </button> -->
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Upload Modal -->
      <div class="modal" *ngIf="showUploadModal">
        <div class="modal-overlay" (click)="closeUploadModal()"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h2>Upload File</h2>
            <button class="close-button" (click)="closeUploadModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="fileName">File Name (Optional)</label>
              <input 
                type="text" 
                id="fileName"
                [(ngModel)]="newFileName"
                placeholder="Add a custom name for this file"
                class="form-input"
                [disabled]="isUploading"
              >
              <small class="help-text">
                If left empty, the original file name will be used
              </small>
            </div>
            
            <div class="form-group">
              <label>Select File</label>
              <p class="file-info">PDF, DOCX, or XLSX file. Maximum size: 30 MB</p>
              <input
                type="file"
                #fileInput
                (change)="onFileSelected($event)"
                accept=".pdf,.docx,.xlsx"
                class="file-input"
                hidden
                [disabled]="isUploading"
              />
              
              <div class="file-select-area" [class.uploading]="isUploading">
                <div class="file-info-display">
                  <span class="file-name">{{ selectedFile ? selectedFile.name : 'No file selected' }}</span>
                  <span class="file-size" *ngIf="selectedFile">
                    ({{ formatFileSize(selectedFile.size) }})
                  </span>
                </div>
                <button 
                  [class]="selectedFile ? 'remove-file-button' : 'select-file-button'"
                  (click)="selectedFile ? removeSelectedFile() : fileInput.click()"
                  [disabled]="isUploading"
                >
                <svg *ngIf="!selectedFile" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M7.49967 14.167V9.16699L5.83301 10.8337" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7.5 9.16699L9.16667 10.8337" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.3337 8.33366V12.5003C18.3337 16.667 16.667 18.3337 12.5003 18.3337H7.50033C3.33366 18.3337 1.66699 16.667 1.66699 12.5003V7.50033C1.66699 3.33366 3.33366 1.66699 7.50033 1.66699H11.667" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18.3337 8.33366H15.0003C12.5003 8.33366 11.667 7.50033 11.667 5.00033V1.66699L18.3337 8.33366Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                  {{ selectedFile ? 'Remove' : 'Choose File' }}
                </button>
              </div>
            </div>
            
            <div class="upload-progress" *ngIf="isUploading">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="uploadProgress"></div>
              </div>
              <span class="progress-text">Uploading... {{ uploadProgress }}%</span>
            </div>

            <div class="error-message" *ngIf="errorMessage">
              {{ errorMessage }}
            </div>
          </div>
          
          <div class="modal-footer">
            <button 
              class="cancel-button" 
              (click)="closeUploadModal()" 
              [disabled]="isUploading"
            >
              Cancel
            </button>
            <button 
              class="upload-button" 
              (click)="uploadFile()"
              [disabled]="!selectedFile || isUploading"
            >
              <span *ngIf="!isUploading">Add File</span>
              <span *ngIf="isUploading">Uploading...</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="file-viewer-modal" *ngIf="selectedFileForView" (click)="closeFileViewer()">
  <div class="file-viewer-content" (click)="$event.stopPropagation()">
    <div class="file-viewer-header">
      <h3 class="file-viewer-title">{{ selectedFileForView.name }}</h3>
      <button class="file-viewer-close" (click)="closeFileViewer()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="file-viewer-body">
      <ng-container [ngSwitch]="getFileExtension(selectedFileForView.name).toLowerCase()">
        <ng-container *ngSwitchCase="'pdf'">
          <iframe [src]="fileViewerUrl" class="file-viewer-iframe" *ngIf="fileViewerUrl"></iframe>
        </ng-container>
        <ng-container *ngSwitchCase="'docx'">
          <!-- <div class="docx-content" [innerHTML]="docxContent"></div> -->
        </ng-container>
        <ng-container *ngSwitchCase="'xlsx'">
          <div class="excel-viewer" *ngIf="excelData">
            <table class="excel-table">
              <thead>
                <tr>
                  <th *ngFor="let header of excelData.headers">{{ header }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of excelData.rows">
                  <td *ngFor="let cell of row">{{ cell }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
        <div class="file-preview-error" *ngSwitchDefault>
          Preview not available for this file type. Please download to view.
        </div>
      </ng-container>
    </div>
  </div>
</div>

