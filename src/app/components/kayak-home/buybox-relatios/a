<div class="modal-body mt-3 mb-5">
    <div class="row m-0 p-0">
      <!-- Mobile card wrapper -->
      <div class="col-12 mt-3 mobile-card-wrapper">
        <!-- Relations card -->
        <div class="mobile-card relations-card">
          <h5 class="relation-header">Relations</h5>
          <form class="search-section">
            <div class="search-inputs">
              <select id="retailRelation" class="form-control" [(ngModel)]="selectedRetailRelationId" name="retailRelation" required>
                <option value="" disabled selected>Select Retail Relation</option>
                <option *ngFor="let relation of retailRelations" [ngValue]="relation.id">
                  {{ relation.name }}
                </option>
              </select>
              
              <div class="position-relative">
                <input type="text" id="organizationSearch" name="organizationSearch" class="form-control" placeholder="Search Organization" 
                  [(ngModel)]="searchOrganizationTerm" (input)="onOrganizationInput($event)" 
                  (keydown)="handleOrganizationKeydown($event)" (blur)="handleOrganizationBlur()" 
                  autocomplete="off" required aria-autocomplete="list" aria-controls="organization-suggestions"/>
                <!-- Loading Indicator -->
                <div *ngIf="isSearchingOrganization" class="spinner-grow spinner-grow-sm text-primary position-absolute top-0 end-0 me-2 mt-3" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              
              <div class="position-relative">
                <input type="text" id="tagSearch" name="tagSearch" class="form-control" placeholder="Search by Tag" 
                  [(ngModel)]="searchTagTerm" (input)="onTagInput($event)"
                  (keydown)="handleTagKeydown($event)" (blur)="handleTagBlur($event)" 
                  autocomplete="off" aria-autocomplete="list" aria-controls="tag-suggestions"/>
                <!-- Loading Indicator -->
                <div *ngIf="isSearchingTag" class="spinner-grow spinner-grow-sm text-primary position-absolute top-0 end-0 me-2 mt-3" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
            <!-- Submit Button -->
            <button type="submit" class="submit-btn" (click)="submitOrganizationForm()">
              Submit
            </button>
          </form>
          
          <!-- Suggestions lists moved outside of search-inputs for better mobile layout -->
          <ul class="list-group suggestions-list" *ngIf="showOrganizationSuggestions && organizations.length" id="organization-suggestions" role="listbox">
            <li *ngFor="let org of organizations; let i = index" class="list-group-item list-group-item-action" 
                [class.active]="highlightedOrganizationIndex === i" (click)="selectOrganizationFromList(org)"
                id="organization-suggestion-{{ i }}" role="option" [attr.aria-selected]="highlightedOrganizationIndex === i">
              {{ org.name }}
            </li>
          </ul>
          
          <ul class="list-group suggestions-list" *ngIf="showTagSuggestions && tags.length" id="tag-suggestions" role="listbox" #tagSuggestionList>
            <li *ngFor="let tag of tags; let i = index" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                [class.active]="highlightedTagIndex === i" id="tag-suggestion-{{ i }}" role="option" [attr.aria-selected]="highlightedTagIndex === i">
              <span (click)="selectTagFromList(tag, $event)">{{ tag.name }}</span>
              <button class="btn btn-sm btn-primary" (mousedown)="addTag(tag, $event)">
                Add
              </button>
            </li>
          </ul>
          
          <!-- Table converted to card layout for mobile -->
          <div class="table-container">
            <div *ngFor="let relation of RelationsOrganizations; let i = index" class="relation-item">
              <div class="relation-content">
                <span class="relation-name">{{ relation.name }}</span>
                <span class="category-badge">{{ relation.category }}</span>
              </div>
              <button class="action-btn btn btn_trash" (click)="DeleteOrganizationRelations(relation.id)">
                <i class="fa fa-trash justify-content-center"></i>
              </button>
            </div>
          </div>
          
          <div class="no-data" *ngIf="RelationsOrganizations?.length == 0 || !RelationsOrganizations">
            <p>No data Relations</p>
          </div>
        </div>
      </div>
    </div>
  </div>