<ngx-spinner type="ball-scale-multiple"></ngx-spinner>
<div class="dashboard-container">
  <div class="d-flex flex-column gap-3 scrollable-container">
    <div class="w-100 dashboard-item-container tenants-container">
      <div class="d-flex align-items-center justify-content-between w-100">
        <span class="container-title">Tenants</span>
        <button
          *ngIf="tenants && tenants.length > 0"
          class="kanban-button"
          [routerLink]="['/Kanban', tenants[0].kanbanid]"
        >
          View Kanban
        </button>
      </div>
      <div
        class="w-100 d-flex flex-column align-items-center justify-content-start gap-3 scrollable-container"
      >
        <div class="scrollable-table">
          <table *ngIf="tenants.length > 0" class="table align-middle">
            <thead class="thead-light">
              <tr>
                <th>Name</th>
                <th>Stage</th>
              </tr>
            </thead>
            <tbody *ngIf="tenants.length > 0">
              <tr *ngFor="let tenant of tenants; let index = index">
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <div
                      *ngIf="tenant.logoURL"
                      class="email-organization-image"
                    >
                      <img [src]="tenant.logoURL" alt="organization-image" />
                    </div>
                    <span style="white-space: nowrap">{{ tenant.name }}</span>
                  </div>
                </td>
                <td style="white-space: nowrap">{{ tenant.stageName }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="w-100 dashboard-item-container buyBoxes-container">
      <div class="d-flex align-items-center justify-content-between w-100">
        <span class="container-title">Buyboxes</span>
      </div>
      <div
        class="w-100 d-flex flex-column align-items-center justify-content-start gap-3 scrollable-container"
      >
        <div class="row m-0 w-100 mt-2 mb-2">
          <div class="col-6">
            <input
              type="text"
              class="form-control w-100"
              placeholder="buybox name"
              name="buybox-name-filter"
              [(ngModel)]="buyboxNameFilter"
              (input)="onBuyBoxSearchChange()"
            />
          </div>
          <div class="col-6">
            <input
              type="text"
              class="form-control w-100"
              placeholder="organization name"
              name="buybox-name-filter"
              [(ngModel)]="buyboxOrganizationFilter"
              (input)="onBuyBoxSearchChange()"
            />
          </div>
        </div>

        <div class="scrollable-table">
          <table *ngIf="filterBuyBoxes.length > 0" class="table align-middle">
            <thead class="thead-light">
              <tr>
                <th>Name</th>
                <th style="white-space: nowrap">Organizaion Name</th>
                <th>Stage</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody *ngIf="filterBuyBoxes.length > 0">
              <tr *ngFor="let buyBox of filterBuyBoxes; let index = index">
                <td style="white-space: nowrap">{{ buyBox.buyBoxName }}</td>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <div
                      *ngIf="buyBox.logoURL"
                      class="email-organization-image"
                    >
                      <img [src]="buyBox.logoURL" alt="organization-image" />
                    </div>
                    <span style="white-space: nowrap">{{
                      buyBox.organizationName
                    }}</span>
                  </div>
                </td>
                <td style="white-space: nowrap">{{ buyBox.stageName }}</td>
                <td>
                  <button
                    class="kanban-button"
                    [routerLink]="['/Kanban', buyBox.kanbanid]"
                  >
                    View Kanban
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- <div class="w-100 dashboard-sub-container">
      <div class="dashboard-item-container emails-container">
        <div class="d-flex align-items-center justify-content-between w-100">
          <span class="container-title">Received Emails</span>
          <div *ngIf="userInBox.length > 0" class="container-count">
            {{ userInBox.length }} New
          </div>
        </div>
        <div
          class="w-100 d-flex flex-column align-items-center justify-content-start gap-3 scrollable-container"
        >
          <ng-container *ngFor="let email of userInBox">
            <div class="email-card">
              <div
                class="d-flex align-items-center justify-content-between w-100"
              >
                <div class="d-flex align-items-center gap-2">
                  <div class="calender-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                    >
                      <path
                        d="M6.6665 1.66675V4.16675"
                        stroke="#707791"
                        stroke-width="1.5"
                        stroke-miterlimit="10"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M13.3335 1.66675V4.16675"
                        stroke="#707791"
                        stroke-width="1.5"
                        stroke-miterlimit="10"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M2.9165 7.57495H17.0832"
                        stroke="#707791"
                        stroke-width="1.5"
                        stroke-miterlimit="10"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M17.5 7.08341V14.1667C17.5 16.6667 16.25 18.3334 13.3333 18.3334H6.66667C3.75 18.3334 2.5 16.6667 2.5 14.1667V7.08341C2.5 4.58341 3.75 2.91675 6.66667 2.91675H13.3333C16.25 2.91675 17.5 4.58341 17.5 7.08341Z"
                        stroke="#707791"
                        stroke-width="1.5"
                        stroke-miterlimit="10"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M13.0791 11.4167H13.0866"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M13.0791 13.9167H13.0866"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M9.99607 11.4167H10.0036"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M9.99607 13.9167H10.0036"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M6.91209 11.4167H6.91957"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M6.91209 13.9167H6.91957"
                        stroke="#707791"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </div>
                  <span class="email-calender-label">
                    {{ email.Date | date : "medium" }}
                  </span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <div
                    *ngIf="email.Contact[0].Photo"
                    class="email-broker-image"
                  >
                    <img [src]="email.Contact[0].Photo" alt="broker-image" />
                  </div>
                  <div
                    *ngIf="email.Contact[0].Organization[0].LogoURL"
                    class="email-organization-image"
                  >
                    <img
                      [src]="email.Contact[0].Organization[0].LogoURL"
                      alt="organization-image"
                    />
                  </div>
                </div>
              </div>
              <hr class="container-divider" />
              <div class="d-flex align-items-center justify-content-between">
                <span class="title">
                  {{ email.Subject }}
                </span>
                <div class="d-flex align-items-center gap-2">
                  <button
                    class="email-view"
                    (click)="openEmailBodyModal(emailContent, email.Body)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                    >
                      <path
                        d="M9.99993 13.6083C8.00827 13.6083 6.3916 11.9916 6.3916 9.99993C6.3916 8.00827 8.00827 6.3916 9.99993 6.3916C11.9916 6.3916 13.6083 8.00827 13.6083 9.99993C13.6083 11.9916 11.9916 13.6083 9.99993 13.6083ZM9.99993 7.6416C8.69993 7.6416 7.6416 8.69993 7.6416 9.99993C7.6416 11.2999 8.69993 12.3583 9.99993 12.3583C11.2999 12.3583 12.3583 11.2999 12.3583 9.99993C12.3583 8.69993 11.2999 7.6416 9.99993 7.6416Z"
                        fill="#4d65b4"
                      />
                      <path
                        d="M9.9999 17.5167C6.86657 17.5167 3.90824 15.6834 1.8749 12.5001C0.991569 11.1251 0.991569 8.8834 1.8749 7.50007C3.91657 4.31673 6.8749 2.4834 9.9999 2.4834C13.1249 2.4834 16.0832 4.31673 18.1166 7.50007C18.9999 8.87507 18.9999 11.1167 18.1166 12.5001C16.0832 15.6834 13.1249 17.5167 9.9999 17.5167ZM9.9999 3.7334C7.30824 3.7334 4.73324 5.35007 2.93324 8.17507C2.30824 9.15007 2.30824 10.8501 2.93324 11.8251C4.73324 14.6501 7.30824 16.2667 9.9999 16.2667C12.6916 16.2667 15.2666 14.6501 17.0666 11.8251C17.6916 10.8501 17.6916 9.15007 17.0666 8.17507C15.2666 5.35007 12.6916 3.7334 9.9999 3.7334Z"
                        fill="#4d65b4"
                      />
                    </svg>
                  </button>
                  <button class="email-reply">Reply</button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <div class="dashboard-item-container comments-container">
        <div
          class="d-flex align-items-center justify-content-between mb-3 w-100"
        >
          <span class="container-title">Comments</span>
          <div *ngIf="userComments.length > 0" class="container-count">
            {{ getUserCommentsCount() }} New
          </div>
        </div>
        <div class="w-100 scrollable-container">
          <ng-container *ngFor="let comment of userComments">
            <div class="comment-card">
              <div
                class="d-flex align-items-center justify-content-between w-100"
              >
                <div class="d-flex align-items-center gap-2">
                  <div *ngIf="comment.Photo" class="user-image">
                    <img [src]="comment.Photo" alt="user-image" />
                  </div>
                  <span>
                    {{ comment.Firstname + comment.LastName }}
                  </span>
                </div>
              </div>
              <ng-container *ngFor="let center of comment.ShoppingCenters">
                <div class="comment-sub-card">
                  <div class="title mb-2">
                    {{ center.CenterAddress }}
                  </div>
                  <div
                    class="w-100 d-flex flex-column align-items-center justify-content-start gap-2"
                  >
                    <ng-container
                      *ngFor="let propertyComment of center.PropertiesComments"
                    >
                      <div
                        class="w-100 d-flex align-items-center justify-content-between"
                      >
                        <div class="comment-content">
                          <span class="me-2">&bull;</span>
                          {{ propertyComment.Comment }}
                        </div>
                        <div
                          *ngIf="
                            propertyComment.buyBoxes[0].Organization[0].LogoURL;
                            else noBuyboxImage
                          "
                          class="user-image"
                          [pTooltip]="propertyComment.buyBoxes[0].Name"
                          tooltipPosition="left"
                        >
                          <img
                            [src]="
                              propertyComment.buyBoxes[0].Organization[0]
                                .LogoURL
                            "
                            alt="buybox-image"
                          />
                        </div>
                        <ng-template #noBuyboxImage>
                          <div class="comment-content">
                            {{ propertyComment.buyBoxes[0].Name }}
                          </div>
                        </ng-template>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
            </div>
            <hr class="container-divider" />
          </ng-container>
        </div>
      </div>
    </div> -->
  </div>
</div>

<ng-template #emailContent let-modal>
  <div class="modal-body">
    <div [innerHTML]="selectedEmailBody"></div>
  </div>
</ng-template>
