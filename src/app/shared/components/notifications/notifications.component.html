<div class="chat-container position-relative" style="z-index: 1000">
  <button
    (click)="toggleDropdown()"
    class="chat-button bot-icon"
    aria-label="Chat with Cherry Bot"
  >
    <!-- Bot Icon -->
    <img
      width="55"
      height="55"
      src="../../../../assets/Images/bot.png"
      alt=""
    />
  </button>

  <!-- Unread Count Badge -->
  <div class="chat-badge" *ngIf="notificationService.unreadCount > 0">
    {{ notificationService.unreadCount }}
  </div>

  <!-- Chat Dropdown with multiple visibility checks -->
  <div
    class="chat-dropdown"
    [style.display]="isVisible ? 'flex' : 'none'"
    [class.hidden]="!notificationService.dropdownVisible"
  >
    <div class="chat-card">
      <!-- Header -->
      <div class="chat-header">
        <div class="chat-header-content">
          <!-- <div class="bot-avatar">
            <img width="30"height="30" src="../../../../assets/Images/bot.png" alt="">

          </div> -->
          <h2 class="chat-title">Emily</h2>
        </div>
        <div class="unread-badge" *ngIf="notificationService.unreadCount > 0">
          {{ notificationService.unreadCount }}
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="chat-messages-container">
        <div
          *ngIf="notificationService.notifications.length > 0; else noMessages"
          class="chat-messages"
        >
          <div
            class="message-bubble"
            *ngFor="let notification of notificationService.notifications"
            (click)="handleNotificationClick(notification)"
            [class.clickable]="notification.userSubmissionId"
          >
            <div class="message-content">
              <p class="message-text">
                {{ notification.message }}
              </p>
              <time class="message-time" [dateTime]="notification.createdDate">
                {{ notification.createdDate | date : "shortTime" }}
              </time>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <ng-template #noMessages>
          <div class="no-messages">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              stroke="#999"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
            <p>No messages available.</p>
            <p class="no-messages-subtext">
              Check back later for updates from Cherry Bot.
            </p>
          </div>
        </ng-template>
      </div>

      <!-- Chat Input (Disabled for now) -->
      <!-- <div class="chat-input-container">
        <input 
          type="text" 
          class="chat-input" 
          placeholder="Message is disabled for now..." 
          disabled
        />
        <button class="send-button" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M7.39999 6.32003L15.89 3.49003C19.7 2.22003 21.77 4.30003 20.51 8.11003L17.68 16.6C15.78 22.31 12.66 22.31 10.76 16.6L9.91999 14.08L7.39999 13.24C1.68999 11.34 1.68999 8.23003 7.39999 6.32003Z" stroke="#B51F63" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10.11 13.6501L13.69 10.0601" stroke="#B51F63" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div> -->
    </div>
  </div>
</div>
