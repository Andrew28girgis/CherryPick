<!-- Redesigned as vertical sidebar similar to GitHub Copilot with chat-like messages -->
<div class="copilot-sidebar-container" [class.open]="isOpen">
  <!-- Vertical Tab/Button -->
  <div class="sidebar-tab" (click)="toggleSidebar()">
    <div class="collapse-icon">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </div>
    <div class="tab-icon">
      <img
        width="24"
        height="24"
        src="../../../../assets/Images/bot.png"
        alt="Copilot"
      />
    </div>
    
    <!-- Unread Count Badge -->
    <div class="unread-badge" *ngIf="notificationService.unreadCount > 0">
      {{ notificationService.unreadCount }}
    </div>
    
    <div class="tab-text">
      <span>Emily</span>
    </div>
  </div>

  <!-- Sidebar Panel -->
  <div class="sidebar-panel" [class.visible]="isOpen">
    <div class="sidebar-header">
      <div class="header-content">
   
        <h3 class="sidebar-title">Chat with Emily</h3>
      </div>
      <button class="close-button" (click)="toggleSidebar()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages-container">
      <div
        *ngIf="notificationService.notifications.length > 0; else noMessages"
        class="chat-messages"
      >
        <div
          class="message-bubble"
          *ngFor="let notification of notificationService.notifications"
          (click)="handleNotificationClick(notification)"
          [class.clickable]="notification.userSubmissionId"
        >
          <div class="message-content">
            <p class="message-text">
              {{ notification.message }}
            </p>
            <time class="message-time" [dateTime]="notification.createdDate">
               {{ notification.createdDate |date:'shortTime' }}
            </time>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <ng-template #noMessages>
        <div class="no-messages">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="var(--Colors-Primary-500)"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1-2-2h14a2 2 0 0 1-2 2z"></path>
          </svg>
          <p>No messages yet.</p>
          <p class="no-messages-subtext">
            Start chatting with Emily for updates and assistance.
          </p>
        </div>
      </ng-template>
    </div>

    <!-- Mark all as read button -->
    <div class="sidebar-footer" *ngIf="notificationService.unreadCount > 0">
      <button class="mark-all-read-btn" (click)="markAllAsRead()">
        Mark all as read
      </button>
    </div>
  </div>
</div>
