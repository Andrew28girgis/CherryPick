<div id="customToast" class="custom-toast">
  <div class="toast-content">
    <p id="toastMessage"></p>
  </div>
</div>

<div class="automation-container">
  <div class="d-flex justify-content-end">
    <button class="close" (click)="close()">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <h2>{{ shoppingCenterName }}</h2>
  <!-- Accept All button -->
  <div
    class="action-section d-flex justify-content-end m-4"
    *ngIf="automationResponses.length > 0"
  >
    <button class="accept-button" (click)="acceptAll()">
      Add All Contacts
    </button>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="automationResponses.length === 0">
    <p>No automation responses found.</p>
  </div>

  <!-- Message Box (now shows ConclusionMessage) -->
  <div class="response-section" *ngIf="conclusionMessage">
    <h4>Message</h4>
    <div class="message-box">
      {{ conclusionMessage }}
    </div>
  </div>

  <!-- Table View -->
  <div class="table-responsive">
    <table class="contacts-table" *ngIf="automationResponses.length > 0">
      <thead>
        <tr>
          <!-- <th>#</th> -->
          <th *ngFor="let col of tableColumns">{{ col }}</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let response of automationResponses; let i = index">
          <!-- <td>{{ i + 1 }}</td> -->

          <td
            *ngFor="let col of tableColumns"
            [ngClass]="{ 'email-cell': col.toLowerCase() === 'email' }"
          >
            <ng-container *ngIf="col === 'Name'; else defaultColumn">
              {{
                (
                  (response.jsonResponse?.firstname || "") +
                  " " +
                  (response.jsonResponse?.lastname || "")
                ).trim()
              }}
            </ng-container>
            <ng-template #defaultColumn>
              {{ response.jsonResponse?.[col] || '-' }}
            </ng-template>
          </td>

          <td>
            <!-- Show Add Contact button only for valid emails (contains @) -->
            <ng-container *ngIf="isValidEmail(response.jsonResponse?.email)">
              <button
                class="accept-button"
                (click)="respondToAutomation(response)"
              >
                Add Contact
              </button>
            </ng-container>
            <!-- Show Find Email button for invalid or missing emails -->
            <ng-container *ngIf="!isValidEmail(response.jsonResponse?.email)">
              <button class="add-email-button">Find Email</button>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
