<div (click)="onDocumentsClick()">
  <!-- Header Section -->
  <div class="title-div">
    <h2 class="title">Sites Vault</h2>
  </div>
  <div class="header-container d-flex flex-row justify-content-between">
    <div
      class="search-filter d-flex flex-row"
      style="gap: 12px; width: 88% !important"
    >
      <div class="search-section">
        <div class="search-container">
          <div class="icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <path
                d="M9.58366 18.1248C4.87533 18.1248 1.04199 14.2915 1.04199 9.58317C1.04199 4.87484 4.87533 1.0415 9.58366 1.0415C14.292 1.0415 18.1253 4.87484 18.1253 9.58317C18.1253 14.2915 14.292 18.1248 9.58366 18.1248ZM9.58366 2.2915C5.55866 2.2915 2.29199 5.5665 2.29199 9.58317C2.29199 13.5998 5.55866 16.8748 9.58366 16.8748C13.6087 16.8748 16.8753 13.5998 16.8753 9.58317C16.8753 5.5665 13.6087 2.2915 9.58366 2.2915Z"
                fill="#704E73"
              />
              <path
                d="M18.3335 18.9585C18.1752 18.9585 18.0169 18.9002 17.8919 18.7752L16.2252 17.1085C15.9835 16.8669 15.9835 16.4669 16.2252 16.2252C16.4669 15.9835 16.8669 15.9835 17.1085 16.2252L18.7752 17.8919C19.0169 18.1335 19.0169 18.5335 18.7752 18.7752C18.6502 18.9002 18.4919 18.9585 18.3335 18.9585Z"
                fill="#704E73"
              />
            </svg>
          </div>
          <input
            type="text"
            class="search-input"
            placeholder="Search..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            (click)="$event.stopPropagation()"
          />
        </div>
      </div>
      <div class="actions-section">
         <!-- <div class="dropdown" ngbDropdown>
          <button class="filter-btn" ngbDropdownToggle>
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polygon
                points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"
              ></polygon>
            </svg>
            <span> Filter </span>
          </button>
          <div class="dropdown-menu" ngbDropdownMenu>
     

            <h3 class="dropdown-header" *ngIf="availableStates.length">
              State
            </h3>

            <div class="mb-3" *ngIf="availableStates.length">
              <select
                class="form-select"
                [(ngModel)]="stateFilter"
                (change)="onFilterChange()"
              >
                <option value="all">All States</option>
                <option *ngFor="let state of availableStates" [value]="state">
                  {{ state }}
                </option>
              </select>
            </div>

            <h3 class="dropdown-header" *ngIf="availableTypes.length">
              Property Type
            </h3>
            <div class="mb-3" *ngIf="availableTypes.length">
              <select
                class="form-select"
                [(ngModel)]="typeFilter"
                (change)="onFilterChange()"
              >
                <option value="all">All Types</option>
                <option *ngFor="let type of availableTypes" [value]="type">
                  {{ type }}
                </option>
              </select>
            </div>

            <h3 class="dropdown-header" *ngIf="availableLeaseTypes.length">
              Lease Type
            </h3>
            <div class="mb-3" *ngIf="availableLeaseTypes.length">
              <select
                class="form-select"
                [(ngModel)]="leaseTypeFilter"
                (change)="onFilterChange()"
              >
                <option value="all">All Lease Types</option>
                <option
                  *ngFor="let leaseType of availableLeaseTypes"
                  [value]="leaseType"
                >
                  {{ leaseType }}
                </option>
              </select>
            </div>
            <div class="mt-4 mb-3 d-flex justify-content-center">
              <button
                class="btn btn-secondary reset-btn"
                (click)="resetFilters(); $event.stopPropagation()"
              >
                Reset Filters
              </button>
            </div>
          </div>
        </div> -->

        <!-- Sort Dropdown -->
        <!-- <div class="dropdown" ngbDropdown>
          <button class="sort-btn" ngbDropdownToggle>
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="7" y1="12" x2="17" y2="12"></line>
              <line x1="10" y1="18" x2="14" y2="18"></line>
            </svg>
            Sort
          </button>
          <div class="dropdown-menu" ngbDropdownMenu>
            <div class="px-3">
              <div class="form-check" *ngFor="let option of sortOptions">
                <input
                  type="radio"
                  class="form-check-input"
                  [id]="option.value"
                  name="sort"
                  [value]="option.value"
                  [(ngModel)]="sortBy"
                  (change)="onSortChange()"
                />
                <label class="form-check-label" [for]="option.value">{{
                  option.label
                }}</label>
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>

    <!-- ===================== Upload Button ===================== -->
    <div class="add-new-actions">
      <button class="g-button" (click)="openUploadModal(uploadModal)">
        <svg
          class="btn-icon"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
            stroke="currentColor"
            stroke-width="2"
          />
          <path
            d="M12 8V16"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
          <path
            d="M8 12H16"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
        <span class="btn-text">Upload OM Files</span>
      </button>
    </div>

    <!-- ===================== Upload Modal =====px-3 mb-3================ -->
    <ng-template #uploadModal let-modal>
      <div class="modal-header">
        <h5 class="modal-title">Upload OM PDF</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="modal.dismiss()"
        ></button>
      </div>

      <div class="modal-body">
        <ngx-file-drop
          dropZoneLabel="Drop files here or click to browse"
          (onFileDrop)="dropped($event)"
          (onFileOver)="fileOver($event)"
          (onFileLeave)="fileLeave($event)"
          [accept]="'application/pdf,.pdf'"
          [multiple]="false"
          class="file-drop-zone"
        >
          <ng-template
            ngx-file-drop-content-tmp
            let-openFileSelector="openFileSelector"
          >
            <div
              class="file-drop-content"
              (click)="openFileSelector(); $event.stopPropagation()"
            >
              <svg
                class="upload-icon"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17 8L12 3L7 8"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M12 3V15"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <p class="mb-0">
                Drop PDF files here or
                <button
                  type="button"
                  class="browse-btn"
                  (click)="openFileSelector(); $event.stopPropagation()"
                >
                  browse
                </button>
              </p>
              <small>Only PDF files are accepted</small>
            </div>
          </ng-template>
        </ngx-file-drop>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="modal.close()">Close</button>
      </div>
    </ng-template>
  </div>

  <!-- Loading State -->
  <div class="main-inner">
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading shopping centers...</p>
    </div>

    <!-- Skeleton Loading State -->
    <div class="skeleton-grid" *ngIf="isLoading">
      <div class="skeleton-card" *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8, 9]">
        <div class="skeleton-image">
          <div class="skeleton-overlay">
            <div class="skeleton-badge"></div>
            <div class="skeleton-menu"></div>
          </div>
        </div>
        <div class="skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-address"></div>
          <div class="skeleton-details">
            <div class="skeleton-price"></div>
            <div class="skeleton-price-line">
              <div class="skeleton-price-sf"></div>
              <div class="skeleton-unit-size"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Filterations Section -->
      <div class="col-3">
        <div class="filters-panel">
      
          <div class="filters-header">
            <div class="filters-title">Filter</div>
            <div class="filters-title clear-filterr" (click)="resetFilters()">
              Clear Filters
            </div>
          </div>
      
          <!-- State Filter -->
          <div class="filter-block" *ngIf="availableStates.length">
            <div class="filter-block-title">State</div>
            <label
              class="filter-check"
              *ngFor="let state of availableStates"
            >
              <input
                type="checkbox"
                [value]="state"
                [(ngModel)]="stateSelections[state]"
                (change)="onFilterChange()"
              />
              <span>{{ state }}</span>
            </label>
          </div>
      
          <!-- Property Type Filter -->
          <div class="filter-block" *ngIf="availableTypes.length">
            <div class="filter-block-title">Property Type</div>
            <label
              class="filter-check"
              *ngFor="let type of availableTypes"
            >
              <input
                type="checkbox"
                [value]="type"
                [(ngModel)]="typeSelections[type]"
                (change)="onFilterChange()"
              />
              <span>{{ type }}</span>
            </label>
          </div>
      
          <!-- Lease Type Filter -->
          <div class="filter-block" *ngIf="availableLeaseTypes.length">
            <div class="filter-block-title">Lease Type</div>
            <label
              class="filter-check"
              *ngFor="let leaseType of availableLeaseTypes"
            >
              <input
                type="checkbox"
                [value]="leaseType"
                [(ngModel)]="leaseTypeSelections[leaseType]"
                (change)="onFilterChange()"
              />
              <span>{{ leaseType }}</span>
            </label>
          </div>
      
          <!-- Buttons -->
          <div class="filters-actions">
            <button type="button" class="btn-base btn-cancel" (click)="resetFilters()">
              Clear
            </button>
            <!-- <button
              type="button"
              class="btn-base btn-filter"
              (click)="onFilterChange()"
            >
              Filter
            </button> -->
          </div>
        </div>
      </div>
      
      
      <div class="col-9">
        <!-- Shopping Centers Grid -->
        <div
          class="centers-grid"
          *ngIf="!isLoading && viewMode === 'grid' && !isLoading"
        >
          <div
            class="center-card"
            *ngFor="let center of filteredCenters; trackBy: trackByCenterId"
            [ngClass]="{
              'enriching-card': center.Running === 0 && center.Queue < 1,
              'queued-card':
                (center.Running === 0 ||
                  center.Running === 1 ||
                  center.Running === 2) &&
                center.Queue >= 1
            }"
          >
            <div
              class="card-click-area"
              [class.click-disabled]="openMenuId === center.scId"
            >
              <div
                (click)="$event.stopPropagation()"
                *ngIf="
                  center.Running === 0 ||
                  center.Running === 1 ||
                  center.Running === 2
                "
                class="automating"
              >
                <span *ngIf="center.Queue >= 1" style="font-size: 13px"
                  >Queued: {{ center.Queue }} to go</span
                >
                <span
                  *ngIf="center.Running === 0 && center.Queue < 1"
                  style="font-size: 13px"
                >
                  Enriching
                  <span class="stat-bars auto-stat" aria-hidden="true">
                    <span></span><span></span><span></span><span></span
                    ><span></span><span></span>
                  </span>
                </span>
              </div>
              <div class="image-container">
                <img
                  loading="lazy"
                  [src]="center.mainImage || 'assets/Images/placeholder.png'"
                  [alt]="center.centerName"
                  class="center-image"
                  (error)="center.mainImage = 'assets/Images/placeholder.png'"
                  [routerLink]="[
                    '/landing',
                    0,
                    center?.scId,
                    center.campaignId
                  ]"
                />

                <div
                  (click)="
                    openCampaignModal(campaignModal, center);
                    $event.stopPropagation()
                  "
                  class="add-badge"
                  title="Add Campaign"
                >
                  +
                </div>
                <button
                  class="add-badge reload"
                  [ngClass]="{ rotate: rotatingKeys[center.scId] > 0 }"
                  (click)="
                    InsertAutomation(center.scId, 1); $event.stopPropagation()
                  "
                  *ngIf="
                    center.Running !== 0 ||
                    center.Running !== 1 ||
                    center.Running !== 2
                  "
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <path
                      d="M12.0001 22.75C6.80008 22.75 2.58008 18.52 2.58008 13.33C2.58008 8.13999 6.80008 3.89999 12.0001 3.89999C13.0701 3.89999 14.1101 4.04999 15.1101 4.35999C15.5101 4.47999 15.7301 4.89999 15.6101 5.29999C15.4901 5.69999 15.0701 5.91999 14.6701 5.79999C13.8201 5.53999 12.9201 5.39999 12.0001 5.39999C7.63008 5.39999 4.08008 8.94999 4.08008 13.32C4.08008 17.69 7.63008 21.24 12.0001 21.24C16.3701 21.24 19.9201 17.69 19.9201 13.32C19.9201 11.74 19.4601 10.22 18.5901 8.91999C18.3601 8.57999 18.4501 8.10999 18.8001 7.87999C19.1401 7.64999 19.6101 7.73999 19.8401 8.08999C20.8801 9.63999 21.4301 11.45 21.4301 13.33C21.4201 18.52 17.2001 22.75 12.0001 22.75Z"
                      fill="#704E73"
                    />
                    <path
                      d="M16.1304 6.06999C15.9204 6.06999 15.7104 5.97999 15.5604 5.80999L12.6704 2.49C12.4004 2.18 12.4304 1.69999 12.7404 1.42999C13.0504 1.15999 13.5304 1.18999 13.8004 1.49999L16.6904 4.82C16.9604 5.13 16.9304 5.60999 16.6204 5.87999C16.4904 6.00999 16.3104 6.06999 16.1304 6.06999Z"
                      fill="#704E73"
                    />
                    <path
                      d="M12.7602 8.52999C12.5302 8.52999 12.3002 8.41999 12.1502 8.21999C11.9102 7.88999 11.9802 7.41999 12.3102 7.16999L15.6802 4.70999C16.0102 4.45999 16.4802 4.53999 16.7302 4.86999C16.9802 5.19999 16.9002 5.66999 16.5702 5.91999L13.2002 8.38999C13.0702 8.48999 12.9202 8.52999 12.7602 8.52999Z"
                      fill="#704E73"
                    />
                  </svg>
                </button>
                <div
                  *ngIf="center.docsLink"
                  class="add-badge docs"
                  (click)="$event.stopPropagation()"
                >
                  <a
                    class="info-value text-dark"
                    [href]="center.docsLink"
                    target="_blank"
                  >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </div>

                <div
                  (click)="$event.stopPropagation()"
                  class="date score"
                  *ngIf="center.lastUpdateDate"
                >
                  {{ center.lastUpdateDate | date }}
                  <span *ngIf="center.source">
                    <span class="source">By </span
                    >{{ getSourceDisplay(center.source) }}
                  </span>
                </div>

                <div class="card-overlay">
                  <!-- Only show shared badge if center is shared -->
                  <div class="share-badge" *ngIf="center.isShared">
                    <svg
                      width="12"
                      height="12"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Shared
                    <svg
                      width="12"
                      height="12"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <circle cx="12" cy="12" r="1"></circle>
                    </svg>
                  </div>
                  <div class="menu-wrapper" (click)="$event.stopPropagation()">
                    <button
                      class="menu-btn"
                      (click)="toggleMenu(center.scId, $event)"
                    >
                      <!-- your 3-dots SVG -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 20 20"
                        fill="none"
                      >
                        <path
                          d="M4.16699 8.20801C5.15737 8.20818 5.95801 9.00958 5.95801 10C5.95783 10.9903 5.15726 11.7908 4.16699 11.791C3.17658 11.791 2.37518 10.9904 2.375 10C2.375 9.00948 3.17647 8.20801 4.16699 8.20801ZM4.16699 8.45801C3.31585 8.45801 2.625 9.14886 2.625 10C2.62518 10.851 3.31596 11.541 4.16699 11.541C5.01788 11.5408 5.70783 10.8509 5.70801 10C5.70801 9.14897 5.01799 8.45818 4.16699 8.45801Z"
                          fill="#18171F"
                          stroke="#18171F"
                        />
                        <path
                          d="M15.8334 12.2913C14.5667 12.2913 13.5417 11.2663 13.5417 9.99967C13.5417 8.73301 14.5667 7.70801 15.8334 7.70801C17.1001 7.70801 18.1251 8.73301 18.1251 9.99967C18.1251 11.2663 17.1001 12.2913 15.8334 12.2913ZM15.8334 8.95801C15.2584 8.95801 14.7917 9.42467 14.7917 9.99967C14.7917 10.5747 15.2584 11.0413 15.8334 11.0413C16.4084 11.0413 16.8751 10.5747 16.8751 9.99967C16.8751 9.42467 16.4084 8.95801 15.8334 8.95801Z"
                          fill="#18171F"
                        />
                        <path
                          d="M9.99992 12.2913C8.73325 12.2913 7.70825 11.2663 7.70825 9.99967C7.70825 8.73301 8.73325 7.70801 9.99992 7.70801C11.2666 7.70801 12.2916 8.73301 12.2916 9.99967C12.2916 11.2663 11.2666 12.2913 9.99992 12.2913ZM9.99992 8.95801C9.42492 8.95801 8.95825 9.42467 8.95825 9.99967C8.95825 10.5747 9.42492 11.0413 9.99992 11.0413C10.5749 11.0413 11.0416 10.5747 11.0416 9.99967C11.0416 9.42467 10.5749 8.95801 9.99992 8.95801Z"
                          fill="#18171F"
                        />
                      </svg>
                    </button>

                    <!-- DROPDOWN -->
                    <div
                      class="menu-dropdown"
                      *ngIf="openMenuId === center.scId"
                    >
                      <button
                        class="menu-item"
                        (click)="onEnriche(center); closeMenu()"
                      >
                        Enriche Data
                      </button>
                      <button
                        class="menu-item"
                        (click)="deleteCenter(center.scId); closeMenu()"
                      >
                        Delete Center
                      </button>
                    </div>
                  </div>
                  <div
                    class="click-shield"
                    *ngIf="openMenuId === center.scId"
                    (click)="closeMenu()"
                  ></div>
                </div>
              </div>

              <div class="center-info">
                <h3 class="center-name">{{ center.centerName }}</h3>
                <p class="center-address">
                  {{ center.centerAddress
                  }}{{ center.centerCity ? " , " + center.centerCity : ""
                  }}{{ center.centerState ? " , " + center.centerState : "" }}
                  {{ center.centerZibCode ? " , " + center.centerZibCode : "" }}
                </p>
                <p class="center-address">{{ center.centerCounty }}</p>
                <div class="center-details">
                  <span
                    class="purchase-price"
                    *ngIf="center.forSalePrice && center.forSalePrice > 0"
                    >Purchase Price</span
                  >
                  <span class="info-badge" *ngIf="center.centerType">{{
                    center.centerType
                  }}</span>
                </div>
                <div class="price-line" *ngIf="center.buildingSizeSf">
                  <span
                    *ngIf="center.forSalePrice && center.forSalePrice > 0"
                    class="price-per-sf"
                    >1.2% SF-1.568 SF</span
                  >
                  <span *ngIf="center.buildingSizeSf" class="unit-size">
                    {{ center.buildingSizeSf }} SF</span
                  >
                </div>

                <div
                  class="property-details"
                  *ngIf="center.shoppingCenter?.places"
                >
                  <div class="detail-row gap-2">
                    <!-- Building Size Range -->
                    <span
                      *ngIf="
                        getMinMaxSizes(center.shoppingCenter.places) as sizes
                      "
                      class="building-size"
                    >
                    <span *ngIf="sizes.min!==sizes.max">

                      {{ sizes.min | number }} - {{ sizes.max | number }} SF
                    </span>
                    <span *ngIf="sizes.min===sizes.max">

                      {{ sizes.min | number }} SF
                    </span>

                    </span>

                    <!-- Price Range -->
                    <span
                      *ngIf="
                        getMinMaxPrices(center.shoppingCenter.places) as prices
                      "
                      class="price w-100"
                    >
                      <ng-container *ngIf="prices.min > 0 || prices.max > 0">
                        <ng-container *ngIf="prices.min === prices.max">
                          ${{ prices.min | number }}
                        </ng-container>
                        <ng-container *ngIf="prices.min !== prices.max">
                          ${{ prices.min | number }} - ${{
                            prices.max | number
                          }}
                        </ng-container>
                      </ng-container>
                    </span>
                  </div>
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-top: 10px;
                  "
                >
                  <div
                    class="leased-by"
                    *ngIf="center?.shoppingCenter?.managerOrganization?.length"
                    (click)="
                      toggleOrgMenu(center.scId, $event);
                      $event.stopPropagation()
                    "
                  >
                    <img
                      *ngIf="center.managerORGLogoURL"
                      src="{{ center.managerORGLogoURL }}"
                      alt=""
                      width="30"
                      height="30"
                      class="mx-1"
                    />
                    <span class="MangerORG">
                      {{ center?.managerORG || "—" }}</span
                    >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M11.9999 16.3299C9.60992 16.3299 7.66992 14.3899 7.66992 11.9999C7.66992 9.60992 9.60992 7.66992 11.9999 7.66992C14.3899 7.66992 16.3299 9.60992 16.3299 11.9999C16.3299 14.3899 14.3899 16.3299 11.9999 16.3299ZM11.9999 9.16992C10.4399 9.16992 9.16992 10.4399 9.16992 11.9999C9.16992 13.5599 10.4399 14.8299 11.9999 14.8299C13.5599 14.8299 14.8299 13.5599 14.8299 11.9999C14.8299 10.4399 13.5599 9.16992 11.9999 9.16992Z"
                        fill="#292D32"
                      />
                      <path
                        d="M12.0001 21.02C8.24008 21.02 4.69008 18.82 2.25008 15C1.19008 13.35 1.19008 10.66 2.25008 8.99998C4.70008 5.17998 8.25008 2.97998 12.0001 2.97998C15.7501 2.97998 19.3001 5.17998 21.7401 8.99998C22.8001 10.65 22.8001 13.34 21.7401 15C19.3001 18.82 15.7501 21.02 12.0001 21.02ZM12.0001 4.47998C8.77008 4.47998 5.68008 6.41998 3.52008 9.80998C2.77008 10.98 2.77008 13.02 3.52008 14.19C5.68008 17.58 8.77008 19.52 12.0001 19.52C15.2301 19.52 18.3201 17.58 20.4801 14.19C21.2301 13.02 21.2301 10.98 20.4801 9.80998C18.3201 6.41998 15.2301 4.47998 12.0001 4.47998Z"
                        fill="#292D32"
                      />
                    </svg>
                    <!-- trigger -->
                    <div class="org-info-trigger">
                      <div
                        class="org-mini-menu"
                        *ngIf="openOrgMenuId === center.scId"
                        [ngStyle]="orgMenuPos"
                        (click)="$event.stopPropagation()"
                      >
                        <div
                          *ngFor="
                            let org of center.shoppingCenter
                              .managerOrganization;
                            let i = index
                          "
                          class="org-mini-item"
                          (click)="openContactModal(center)"
                        >
                          <p class="name">
                            {{ org.firstname | titlecase }}
                            {{ org.lastName | titlecase }}
                          </p>
                          <p class="small">{{ org.email }}</p>
                          <div
                            class="divider"
                            *ngIf="
                              i <
                              center.shoppingCenter.managerOrganization.length -
                                1
                            "
                          ></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    (click)="$event.stopPropagation()"
                    class="d-flex justify-content-end gap-3 w-100"
                  >
                    <div class="street-view">
                      <a
                        class="target"
                        (click)="openStreetViewPlace(StreetViewPlace, center)"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="none"
                        >
                          <path
                            d="M12.875 10.4795C13.4656 10.6906 13.9543 10.9406 14.3145 11.2207C14.7916 11.5918 15 11.9774 15 12.375C15 12.7171 14.8475 13.0452 14.5088 13.3652C14.1632 13.6916 13.6427 13.989 12.9736 14.2383C11.637 14.7362 9.82503 15 8 15C6.17497 15 4.36301 14.7362 3.02637 14.2383C2.35725 13.989 1.83682 13.6916 1.49121 13.3652C1.15247 13.0452 1 12.7171 1 12.375C1 11.9774 1.20837 11.5918 1.68555 11.2207C2.0457 10.9406 2.53444 10.6906 3.125 10.4795V10.752C2.65623 10.925 2.25971 11.1182 1.95801 11.3262C1.77158 11.4547 1.60411 11.5983 1.47949 11.7598C1.3564 11.9192 1.25 12.1291 1.25 12.375C1.25 12.6094 1.34695 12.8109 1.46191 12.9668C1.57781 13.1239 1.73351 13.2641 1.90625 13.3887C2.25197 13.6379 2.73008 13.8684 3.30371 14.0654C4.45653 14.4614 6.07492 14.75 8 14.75C9.92508 14.75 11.5435 14.4614 12.6963 14.0654C13.2699 13.8684 13.748 13.6379 14.0938 13.3887C14.2665 13.2641 14.4222 13.1239 14.5381 12.9668C14.653 12.8109 14.75 12.6094 14.75 12.375C14.75 12.1291 14.6436 11.9192 14.5205 11.7598C14.3959 11.5983 14.2284 11.4547 14.042 11.3262C13.7403 11.1182 13.3438 10.925 12.875 10.752V10.4795ZM8 5C6.68138 5 5.625 6.05638 5.625 7.375V9.79297L5.90137 9.93164L6.875 10.418V12.875H9.125V10.418L10.0986 9.93164L10.375 9.79297V7.375C10.375 6.05638 9.31862 5 8 5ZM8 1.25C7.02562 1.25 6.25 2.02562 6.25 3C6.25 3.97438 7.02562 4.75 8 4.75C8.97438 4.75 9.75 3.97438 9.75 3C9.75 2.02562 8.97438 1.25 8 1.25ZM6.625 10.582L6.34863 10.4434L5.375 9.95605V7.375C5.375 6.47551 5.83943 5.66741 6.54199 5.19141L7.04883 4.84766L6.61133 4.41992C6.23466 4.05112 6 3.54923 6 3C6 1.90163 6.90163 1 8 1C9.09837 1 10 1.90163 10 3C10 3.54923 9.76534 4.05112 9.38867 4.41992L8.95117 4.84766L9.45801 5.19141C10.1606 5.66741 10.625 6.47551 10.625 7.375V9.95605L9.65137 10.4434L9.375 10.582V13.125H6.625V10.582Z"
                            fill="#161017"
                            stroke="#161017"
                          />
                        </svg>
                      </a>
                    </div>
                    <div class="map-view">
                      <a
                        class="target"
                        (click)="openMapViewPlace(MapViewPlace, center)"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                        >
                          <path
                            d="M20.3799 21.13C20.1799 21.13 19.9899 21.05 19.8499 20.91L13.4699 14.53C13.1799 14.24 13.1799 13.76 13.4699 13.47L21.2 5.74001C21.39 5.55001 21.6799 5.48001 21.9399 5.55001C22.1999 5.63001 22.3999 5.84001 22.4599 6.10001C22.6499 6.95001 22.7499 7.90001 22.7499 9.00001V15C22.7499 17.77 22.1699 19.64 20.9099 20.91C20.7699 21.05 20.5599 21.08 20.3799 21.13ZM15.0599 14L20.3199 19.26C20.9499 18.29 21.2499 16.91 21.2499 15V9.00001C21.2499 8.59001 21.2399 8.21001 21.2099 7.85001L15.0599 14Z"
                            fill="#292D32"
                          />
                          <path
                            d="M6.26999 22.48C6.20999 22.48 6.16001 22.47 6.10001 22.46C2.79001 21.7 1.25 19.33 1.25 15V9C1.25 3.57 3.57 1.25 9 1.25H15C19.33 1.25 21.7 2.79001 22.46 6.10001C22.52 6.35001 22.44 6.62 22.26 6.8L6.79999 22.26C6.65999 22.4 6.46999 22.48 6.26999 22.48ZM9 2.75C4.39 2.75 2.75 4.39 2.75 9V15C2.75 18.47 3.71001 20.21 6.04001 20.9L20.89 6.05C20.21 3.72 18.46 2.75999 14.99 2.75999H9V2.75Z"
                            fill="#292D32"
                          />
                          <path
                            d="M14.9999 22.7499H8.99989C7.89989 22.7499 6.95989 22.6599 6.09989 22.4599C5.82989 22.3999 5.61987 22.1999 5.54987 21.9399C5.46987 21.6799 5.54988 21.3999 5.73988 21.1999L13.4699 13.4699C13.7599 13.1799 14.2399 13.1799 14.5299 13.4699L20.9099 19.8499C21.0499 19.9899 21.1299 20.1799 21.1299 20.3799C21.1299 20.5799 21.0499 20.7699 20.9099 20.9099C19.6399 22.1699 17.7699 22.7499 14.9999 22.7499ZM7.84989 21.2099C8.20989 21.2399 8.58989 21.2499 8.99989 21.2499H14.9999C16.9199 21.2499 18.2899 20.9499 19.2599 20.3199L13.9999 15.0599L7.84989 21.2099Z"
                            fill="#292D32"
                          />
                          <path
                            d="M9.11994 13.31C8.48994 13.31 7.85993 13.08 7.35993 12.61C5.76993 11.1 5.12996 9.44005 5.50996 7.82005C5.88996 6.16005 7.33994 5.04004 9.11994 5.04004C10.8999 5.04004 12.35 6.16005 12.73 7.82005C13.1 9.45005 12.4599 11.1 10.8699 12.61C10.3799 13.07 9.74994 13.31 9.11994 13.31ZM6.96995 8.15004C6.64995 9.51004 7.56994 10.7301 8.39994 11.5201C8.80994 11.91 9.43994 11.91 9.83994 11.5201C10.6599 10.7401 11.5799 9.52004 11.2699 8.15004C10.9999 6.96004 9.93994 6.53004 9.11994 6.53004C8.29994 6.53004 7.24995 6.96004 6.96995 8.15004Z"
                            fill="#292D32"
                          />
                          <path
                            d="M9.1499 9.49023C8.5999 9.49023 8.1499 9.04023 8.1499 8.49023C8.1499 7.94023 8.5899 7.49023 9.1499 7.49023H9.15991C9.70991 7.49023 10.1599 7.94023 10.1599 8.49023C10.1599 9.04023 9.6999 9.49023 9.1499 9.49023Z"
                            fill="#292D32"
                          />
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Shopping Centers Table -->
        <div
          class="centers-table-wrap"
          *ngIf="!isLoading && viewMode === 'table'"
        >
          <table class="centers-table">
            <thead>
              <tr>
                <th style="width: 48px"></th>
                <th
                  (click)="sortBy = 'name'; onSortChange()"
                  [class.sorting]="true"
                >
                  Name
                </th>
                <th
                  (click)="sortBy = 'address'; onSortChange()"
                  [class.sorting]="true"
                >
                  Address
                </th>
                <th>Type</th>
                <th>Category</th>
                <th>Last Update Date</th>
                <th>Manager ORG</th>
                <th></th>

                <th style="width: 56px"></th>
              </tr>
            </thead>

            <tbody>
              <tr
                *ngFor="let center of filteredCenters"
                [class.click-disabled]="openMenuId === center.scId"
              >
                <!-- Thumb -->
                <td>
                  <img
                    loading="lazy"
                    [src]="center.mainImage || 'assets/Images/placeholder.png'"
                    [alt]="center.centerName"
                    class="thumb"
                    (error)="center.mainImage = 'assets/Images/placeholder.png'"
                  />
                </td>

                <!-- Name -->
                <td>
                  <div class="name-cell">
                    <div class="title">{{ center.centerName }}</div>
                    <div class="id" *ngIf="center.scId">
                      ID: {{ center.scId }}
                    </div>
                  </div>
                </td>

                <!-- Address -->
                <td class="muted">{{ center.centerAddress }}</td>
                <!-- Type -->
                <td class="muted">{{ center.centerType }}</td>
                <!-- category -->
                <td class="muted">{{ center.category }}</td>
                <!-- last update date -->
                <td class="muted">{{ center.lastUpdateDate | date }}</td>
                <!-- manager ORG -->
                <td class="muted">{{ center.organizationName }}</td>
                <td class="link-details">
                  <button
                    class="icon-btn"
                    (click)="onRowNavigate(center, $event)"
                    title="Details"
                  >
                    <!-- paste either SVG from above here -->
                    <!-- stroke-style example -->
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      focusable="false"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M3 12h12"
                        stroke="currentColor"
                        stroke-width="2.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        fill="none"
                      />
                      <path
                        d="M13 6l7 6-7 6"
                        stroke="currentColor"
                        stroke-width="2.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        fill="none"
                      />
                    </svg>
                  </button>
                </td>

                <!-- Actions (same 3-dots dropdown) -->
                <td (click)="$event.stopPropagation()">
                  <div class="menu-wrapper">
                    <button
                      class="menu-btn"
                      (click)="toggleMenu(center.scId, $event)"
                    >
                      <!-- 3 dots svg -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 20 20"
                        fill="none"
                      >
                        <path
                          d="M4.16699 8.20801C5.15737 8.20818 5.95801 9.00958 5.95801 10C5.95783 10.9903 5.15726 11.7908 4.16699 11.791C3.17658 11.791 2.37518 10.9904 2.375 10C2.375 9.00948 3.17647 8.20801 4.16699 8.20801Z"
                          fill="#18171F"
                          stroke="#18171F"
                        />
                        <path
                          d="M15.8334 12.2913C14.5667 12.2913 13.5417 11.2663 13.5417 9.99967C13.5417 8.73301 14.5667 7.70801 15.8334 7.70801C17.1001 7.70801 18.1251 8.73301 18.1251 9.99967C18.1251 11.2663 17.1001 12.2913 15.8334 12.2913ZM15.8334 8.95801C15.2584 8.95801 14.7917 9.42467 14.7917 9.99967C14.7917 10.5747 15.2584 11.0413 15.8334 11.0413C16.4084 11.0413 16.8751 10.5747 16.8751 9.99967C16.8751 9.42467 16.4084 8.95801 15.8334 8.95801Z"
                          fill="#18171F"
                        />
                        <path
                          d="M9.99992 12.2913C8.73325 12.2913 7.70825 11.2663 7.70825 9.99967C7.70825 8.73301 8.73325 7.70801 9.99992 7.70801C11.2666 7.70801 12.2916 8.73301 12.2916 9.99967C12.2916 11.2663 11.2666 12.2913 9.99992 12.2913ZM9.99992 8.95801C9.42492 8.95801 8.95825 9.42467 8.95825 9.99967C8.95825 10.5747 9.42492 11.0413 9.99992 11.0413C10.5749 11.0413 11.0416 10.5747 11.0416 9.99967C11.0416 9.42467 10.5749 8.95801 9.99992 8.95801Z"
                          fill="#18171F"
                        />
                      </svg>
                    </button>

                    <div class="menu-table" *ngIf="openMenuId === center.scId">
                      <button
                        class="menu-item"
                        (click)="onEnriche(center); closeMenu()"
                      >
                        Enriche Data
                      </button>
                      <button class="menu-item" (click)="closeMenu()">
                        Upload OM Files
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination" *ngIf="totalItems > itemsPerPage">
          <button
            class="page-button prev"
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
          >
            Previous
          </button>

          <div class="page-numbers">
            <button
              *ngFor="let page of getPageNumbers()"
              class="page-number"
              [class.active]="currentPage === page"
              [disabled]="page === 0"
              (click)="onPageChange(page)"
            >
              {{ page === 0 ? "..." : page }}
            </button>
          </div>

          <button
            class="page-button next"
            [disabled]="currentPage === totalPages"
            (click)="onPageChange(currentPage + 1)"
          >
            Next
          </button>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div
      class="no-results"
      *ngIf="!isLoading && filteredCenters.length === 0 && centers.length > 0"
    >
      <p>No shopping centers match your search criteria.</p>
    </div>

    <!-- Empty State -->
    <div class="no-results" *ngIf="!isLoading && centers.length === 0">
      <p>No shopping centers available.</p>
    </div>
  </div>
</div>
<!-- File Explorer Component - Simplified integration -->
<app-file-explorer
  #fileExplorer
  [contactID]="contactID"
  (fileSelected)="onFileSelected($event)"
  (onClose)="onFileExplorerClose()"
>
</app-file-explorer>
<ng-template #campaignModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Select Campaign</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss()"
    ></button>
  </div>

  <div class="modal-body">
    <div class="campaign-cards-grid">
      <div
        *ngFor="let campaign of campaigns"
        class="campaign-card"
        [class.selected]="selectedCampaign === campaign"
        (click)="selectedCampaign = campaign"
      >
        <!-- Logo + name -->
        <div class="campaign-header">
          <ng-container *ngIf="campaign.logoUrl; else logoPlaceholder">
            <img
              [src]="campaign.logoUrl"
              class="campaign-logo"
              crossorigin="anonymous"
            />
          </ng-container>
          <ng-template #logoPlaceholder>
            <div class="campaign-logo placeholder">
              {{ campaign.CampaignName.charAt(0) }}
            </div>
          </ng-template>
          <h3 class="campaign-name">{{ campaign.CampaignName }}</h3>
        </div>

        <!-- selection mark -->
        <div class="campaign-check" *ngIf="selectedCampaign === campaign">
          ✓
        </div>
      </div>
      <!-- Add Campaign Card -->
      <div class="campaign-card add-card" (click)="goToAddCampaign()">
        <div class="add-card-content">
          <div class="plus-icon" style="height: 48px !important">+</div>
          <h3 class="campaign-name">Add Campaign</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <!-- <button class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button> -->
    <button
      class="btn btn-primary btn-custom"
      (click)="addCenter(currentCenter, selectedCampaign.Id); modal.close()"
    >
      Add
    </button>
  </div>
</ng-template>

<div id="customToast" class="custom-toast">
  <div class="toast-content">
    <p id="toastMessage"></p>
  </div>
</div>

<ng-template #StreetViewPlace let-modal>
  <div id="street-view" class="h700"></div>
</ng-template>

<ng-template #MapViewPlace let-modal>
  <div id="mappopup" class="h700"></div>
</ng-template>
