<div class="shopping-centers-container" (click)="onDocumentsClick()">
  <!-- Header Section -->
  <div class="header-container d-flex flex-row justify-content-between">
    <div
      class="search-filter d-flex flex-row"
      style="gap: 12px; width: 88% !important"
    >
      <div class="search-section">
        <div class="search-container">
          <div class="icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <path
                d="M9.58366 18.1248C4.87533 18.1248 1.04199 14.2915 1.04199 9.58317C1.04199 4.87484 4.87533 1.0415 9.58366 1.0415C14.292 1.0415 18.1253 4.87484 18.1253 9.58317C18.1253 14.2915 14.292 18.1248 9.58366 18.1248ZM9.58366 2.2915C5.55866 2.2915 2.29199 5.5665 2.29199 9.58317C2.29199 13.5998 5.55866 16.8748 9.58366 16.8748C13.6087 16.8748 16.8753 13.5998 16.8753 9.58317C16.8753 5.5665 13.6087 2.2915 9.58366 2.2915Z"
                fill="#704E73"
              />
              <path
                d="M18.3335 18.9585C18.1752 18.9585 18.0169 18.9002 17.8919 18.7752L16.2252 17.1085C15.9835 16.8669 15.9835 16.4669 16.2252 16.2252C16.4669 15.9835 16.8669 15.9835 17.1085 16.2252L18.7752 17.8919C19.0169 18.1335 19.0169 18.5335 18.7752 18.7752C18.6502 18.9002 18.4919 18.9585 18.3335 18.9585Z"
                fill="#704E73"
              />
            </svg>
          </div>
          <input
            type="text"
            class="search-input"
            placeholder="Search..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            (click)="$event.stopPropagation()"
          />
        </div>
      </div>
      <div class="actions-section">
        <!-- Filter Dropdown -->
        <div class="dropdown" ngbDropdown>
          <button class="filter-btn" ngbDropdownToggle>
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polygon
                points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"
              ></polygon>
            </svg>
            Filter
          </button>
          <div class="dropdown-menu" ngbDropdownMenu>
            <h3 class="dropdown-header">Share Status</h3>
            <div class="radio-group px-3">
              <div class="form-check">
                <input
                  type="radio"
                  class="form-check-input"
                  id="all"
                  name="share"
                  value="all"
                  [(ngModel)]="shareFilter"
                  (change)="onFilterChange()"
                />
                <label class="form-check-label" for="all">All</label>
              </div>
              <div class="form-check">
                <input
                  type="radio"
                  class="form-check-input"
                  id="shared"
                  name="share"
                  value="shared"
                  [(ngModel)]="shareFilter"
                  (change)="onFilterChange()"
                />
                <label class="form-check-label" for="shared">Shared</label>
              </div>
              <div class="form-check">
                <input
                  type="radio"
                  class="form-check-input"
                  id="not-shared"
                  name="share"
                  value="not-shared"
                  [(ngModel)]="shareFilter"
                  (change)="onFilterChange()"
                />
                <label class="form-check-label" for="not-shared"
                  >Not Shared</label
                >
              </div>
            </div>

            <h3 class="dropdown-header mt-3">Price</h3>
            <div class="px-3 mb-3">
              <div class="input-group input-group-sm">
                <input
                  type="number"
                  class="form-control"
                  placeholder="From"
                  [(ngModel)]="priceFrom"
                  (input)="onFilterChange()"
                />
                <input
                  type="number"
                  class="form-control"
                  placeholder="To"
                  [(ngModel)]="priceTo"
                  (input)="onFilterChange()"
                />
              </div>
            </div>

            <h3 class="dropdown-header">Building Size (SF)</h3>
            <div class="px-3 mb-3">
              <div class="input-group input-group-sm">
                <input
                  type="number"
                  class="form-control"
                  placeholder="From"
                  [(ngModel)]="sizeFrom"
                  (input)="onFilterChange()"
                />
                <input
                  type="number"
                  class="form-control"
                  placeholder="To"
                  [(ngModel)]="sizeTo"
                  (input)="onFilterChange()"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Sort Dropdown -->
        <div class="dropdown" ngbDropdown>
          <button class="sort-btn" ngbDropdownToggle>
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="7" y1="12" x2="17" y2="12"></line>
              <line x1="10" y1="18" x2="14" y2="18"></line>
            </svg>
            Sort
          </button>
          <div class="dropdown-menu" ngbDropdownMenu>
            <div class="px-3">
              <div class="form-check" *ngFor="let option of sortOptions">
                <input
                  type="radio"
                  class="form-check-input"
                  [id]="option.value"
                  name="sort"
                  [value]="option.value"
                  [(ngModel)]="sortBy"
                  (change)="onSortChange()"
                />
                <label class="form-check-label" [for]="option.value">{{
                  option.label
                }}</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="add-new-actions">
      <button
        class="add-new-btn"
        (click)="openFileExplorer(); $event.stopPropagation()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 20 20"
          fill="none"
        >
          <path
            d="M5 10H15"
            stroke="white"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M10 15V5"
            stroke="white"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        Add New
      </button>
      <div class="view-toggle-icons" (click)="$event.stopPropagation()">
        <button
          class="icon-btn"
          [class.active]="viewMode === 'grid'"
          (click)="setView('grid')"
          aria-label="Grid view"
          title="Grid view"
        >
          <!-- grid icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <rect
              x="3"
              y="3"
              width="8"
              height="8"
              rx="2"
              stroke="currentColor"
              stroke-width="2"
            />
            <rect
              x="13"
              y="3"
              width="8"
              height="8"
              rx="2"
              stroke="currentColor"
              stroke-width="2"
            />
            <rect
              x="3"
              y="13"
              width="8"
              height="8"
              rx="2"
              stroke="currentColor"
              stroke-width="2"
            />
            <rect
              x="13"
              y="13"
              width="8"
              height="8"
              rx="2"
              stroke="currentColor"
              stroke-width="2"
            />
          </svg>
        </button>

        <button
          class="icon-btn"
          [class.active]="viewMode === 'table'"
          (click)="setView('table')"
          aria-label="Table view"
          title="Table view"
        >
          <!-- table icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <rect
              x="3"
              y="5"
              width="18"
              height="14"
              rx="2"
              stroke="currentColor"
              stroke-width="2"
            />
            <line
              x1="3"
              y1="10"
              x2="21"
              y2="10"
              stroke="currentColor"
              stroke-width="2"
            />
            <line
              x1="10"
              y1="5"
              x2="10"
              y2="19"
              stroke="currentColor"
              stroke-width="2"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="main-inner">
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading shopping centers...</p>
    </div>

    <!-- Skeleton Loading State -->
    <div class="skeleton-grid" *ngIf="isLoading">
      <div class="skeleton-card" *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8, 9]">
        <div class="skeleton-image">
          <div class="skeleton-overlay">
            <div class="skeleton-badge"></div>
            <div class="skeleton-menu"></div>
          </div>
        </div>
        <div class="skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-address"></div>
          <div class="skeleton-details">
            <div class="skeleton-price"></div>
            <div class="skeleton-price-line">
              <div class="skeleton-price-sf"></div>
              <div class="skeleton-unit-size"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

   
    <div class="row">
      <!-- Filterations Section -->
      <div class="col-3">
        <div class="filters-panel">
          <div class="filters-header">
            <div class="filters-title">Filter</div>
            <div class="filters-title clear-filterr">Clear Filters</div>
          </div>

          <div class="filter-block">
            <div class="filter-block-title">Project Status</div>
            <label class="filter-check">
              <input type="checkbox" />
              <span>On Track</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>At Risk</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Off Track</span>
            </label>
          </div>

          <div class="filter-block">
            <div class="filter-block-title">Project Type</div>
            <label class="filter-check">
              <input type="checkbox" />
              <span>QSR</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Medical</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Industrial</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Retail</span>
            </label>
          </div>

          <div class="filter-block">
            <div class="filter-block-title">Client</div>
            <input
              type="text"
              class="filter-input"
              placeholder="Client Name ..."
            />
            <label class="filter-check">
              <input type="checkbox" />
              <span>Osmow's</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Scooters</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Buffalo Burger</span>
            </label>
          </div>

          <div class="filter-block">
            <div class="filter-block-title">Broker</div>
            <input
              type="text"
              class="filter-input"
              placeholder="Broker Name ..."
            />
            <label class="filter-check">
              <input type="checkbox" />
              <span>Hassan Magdy</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Sarah Selim</span>
            </label>
            <label class="filter-check">
              <input type="checkbox" />
              <span>Omar Khaled</span>
            </label>
          </div>

          <div class="filters-actions">
            <button type="button" class="btn-base btn-cancel">Cancel</button>
            <button type="button" class="btn-base btn-filter">Filter</button>
          </div>
        </div>
      </div>
      <div class="col-9">
         <!-- Shopping Centers Grid -->
    <div
      class="centers-grid"
      *ngIf="!isLoading && viewMode === 'grid' && !isLoading"
    >
      <div class="center-card" *ngFor="let center of filteredCenters">
        <div
          class="card-click-area"
          [class.click-disabled]="openMenuId === center.scId"
          [routerLink]="['/landing', 0, center?.scId, center.campaignId]"
        >
          <div class="image-container">
            <img
              loading="lazy"
              [src]="center.mainImage || 'assets/Images/placeholder.png'"
              [alt]="center.centerName"
              class="center-image"
              (error)="center.mainImage = 'assets/Images/placeholder.png'"
            />
            <div class="card-overlay">
              <!-- Only show shared badge if center is shared -->
              <div class="share-badge" *ngIf="center.isShared">
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Shared
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="1"></circle>
                </svg>
              </div>
              <div class="menu-wrapper" (click)="$event.stopPropagation()">
                <button
                  class="menu-btn"
                  (click)="toggleMenu(center.scId, $event)"
                >
                  <!-- your 3-dots SVG -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <path
                      d="M4.16699 8.20801C5.15737 8.20818 5.95801 9.00958 5.95801 10C5.95783 10.9903 5.15726 11.7908 4.16699 11.791C3.17658 11.791 2.37518 10.9904 2.375 10C2.375 9.00948 3.17647 8.20801 4.16699 8.20801ZM4.16699 8.45801C3.31585 8.45801 2.625 9.14886 2.625 10C2.62518 10.851 3.31596 11.541 4.16699 11.541C5.01788 11.5408 5.70783 10.8509 5.70801 10C5.70801 9.14897 5.01799 8.45818 4.16699 8.45801Z"
                      fill="#18171F"
                      stroke="#18171F"
                    />
                    <path
                      d="M15.8334 12.2913C14.5667 12.2913 13.5417 11.2663 13.5417 9.99967C13.5417 8.73301 14.5667 7.70801 15.8334 7.70801C17.1001 7.70801 18.1251 8.73301 18.1251 9.99967C18.1251 11.2663 17.1001 12.2913 15.8334 12.2913ZM15.8334 8.95801C15.2584 8.95801 14.7917 9.42467 14.7917 9.99967C14.7917 10.5747 15.2584 11.0413 15.8334 11.0413C16.4084 11.0413 16.8751 10.5747 16.8751 9.99967C16.8751 9.42467 16.4084 8.95801 15.8334 8.95801Z"
                      fill="#18171F"
                    />
                    <path
                      d="M9.99992 12.2913C8.73325 12.2913 7.70825 11.2663 7.70825 9.99967C7.70825 8.73301 8.73325 7.70801 9.99992 7.70801C11.2666 7.70801 12.2916 8.73301 12.2916 9.99967C12.2916 11.2663 11.2666 12.2913 9.99992 12.2913ZM9.99992 8.95801C9.42492 8.95801 8.95825 9.42467 8.95825 9.99967C8.95825 10.5747 9.42492 11.0413 9.99992 11.0413C10.5749 11.0413 11.0416 10.5747 11.0416 9.99967C11.0416 9.42467 10.5749 8.95801 9.99992 8.95801Z"
                      fill="#18171F"
                    />
                  </svg>
                </button>

                <!-- DROPDOWN -->
                <div class="menu-dropdown" *ngIf="openMenuId === center.scId">
                  <button
                    class="menu-item"
                    (click)="onEnriche(center); closeMenu()"
                  >
                    Enriche Data
                  </button>
                  <button class="menu-item" (click)="closeMenu()">
                    Upload OM Files
                  </button>
                </div>
              </div>
              <div
                class="click-shield"
                *ngIf="openMenuId === center.scId"
                (click)="closeMenu()"
              ></div>
            </div>
          </div>

          <div class="center-info">
            <h3 class="center-name">{{ center.centerName }}</h3>
            <p class="center-address">{{ center.centerAddress }}</p>
            <div class="center-details">
              <span
                class="purchase-price"
                *ngIf="center.forSalePrice && center.forSalePrice > 0"
                >Purchase Price</span
              >
            </div>
            <div class="price-line" *ngIf="center.buildingSizeSf">
              <span
                *ngIf="center.forSalePrice && center.forSalePrice > 0"
                class="price-per-sf"
                >1.2% SF-1.568 SF</span
              >
              <span *ngIf="center.buildingSizeSf" class="unit-size">
                {{ center.buildingSizeSf }} SF</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
              <!-- Shopping Centers Table -->
        <div
          class="centers-table-wrap"
          *ngIf="!isLoading && viewMode === 'table'"
        >
          <table class="centers-table">
            <thead>
              <tr>
                <th style="width: 48px"></th>
                <th
                  (click)="sortBy = 'name'; onSortChange()"
                  [class.sorting]="true"
                >
                  Name
                </th>
                <th
                  (click)="sortBy = 'address'; onSortChange()"
                  [class.sorting]="true"
                >
                  Address
                </th>
                <th style="width: 56px"></th>
              </tr>
            </thead>

            <tbody>
              <tr
                *ngFor="let center of filteredCenters"
                (click)="onRowNavigate(center, $event)"
                [class.click-disabled]="openMenuId === center.scId"
              >
                <!-- Thumb -->
                <td>
                  <img
                    loading="lazy"
                    [src]="center.mainImage || 'assets/Images/placeholder.png'"
                    [alt]="center.centerName"
                    class="thumb"
                    (error)="center.mainImage = 'assets/Images/placeholder.png'"
                  />
                </td>

                <!-- Name -->
                <td>
                  <div class="name-cell">
                    <div class="title">{{ center.centerName }}</div>
                    <div class="id" *ngIf="center.scId">
                      ID: {{ center.scId }}
                    </div>
                  </div>
                </td>

                <!-- Address -->
                <td class="muted">{{ center.centerAddress }}</td>


                <!-- Actions (same 3-dots dropdown) -->
                <td (click)="$event.stopPropagation()">
                  <div class="menu-wrapper">
                    <button
                      class="menu-btn"
                      (click)="toggleMenu(center.scId, $event)"
                    >
                      <!-- 3 dots svg -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 20 20"
                        fill="none"
                      >
                        <path
                          d="M4.16699 8.20801C5.15737 8.20818 5.95801 9.00958 5.95801 10C5.95783 10.9903 5.15726 11.7908 4.16699 11.791C3.17658 11.791 2.37518 10.9904 2.375 10C2.375 9.00948 3.17647 8.20801 4.16699 8.20801Z"
                          fill="#18171F"
                          stroke="#18171F"
                        />
                        <path
                          d="M15.8334 12.2913C14.5667 12.2913 13.5417 11.2663 13.5417 9.99967C13.5417 8.73301 14.5667 7.70801 15.8334 7.70801C17.1001 7.70801 18.1251 8.73301 18.1251 9.99967C18.1251 11.2663 17.1001 12.2913 15.8334 12.2913Z"
                          fill="#18171F"
                        />
                        <path
                          d="M9.99992 12.2913C8.73325 12.2913 7.70825 11.2663 7.70825 9.99967C7.70825 8.73301 8.73325 7.70801 9.99992 7.70801C11.2666 7.70801 12.2916 8.73301 12.2916 9.99967C12.2916 11.2663 11.2666 12.2913 9.99992 12.2913Z"
                          fill="#18171F"
                        />
                      </svg>
                    </button>

                    <div
                      class="menu-dropdown"
                      *ngIf="openMenuId === center.scId"
                    >
                      <button
                        class="menu-item"
                        (click)="onEnriche(center); closeMenu()"
                      >
                        Enriche Data
                      </button>
                      <button class="menu-item" (click)="closeMenu()">
                        Upload OM Files
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="totalItems > itemsPerPage">
          <button
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
          >
            Previous
          </button>

          <button
            class="pagination-btn"
            [class.active]="currentPage === 1"
            (click)="onPageChange(1)"
            *ngIf="shouldShowLeftDots()"
          >
            1
          </button>

          <span class="pagination-ellipsis" *ngIf="shouldShowLeftDots()"
            >...</span
          >

          <button
            *ngFor="let page of visiblePages"
            class="pagination-btn"
            [class.active]="currentPage === page"
            (click)="onPageChange(page)"
          >
            {{ page }}
          </button>

          <span class="pagination-ellipsis" *ngIf="shouldShowRightDots()"
            >...</span
          >

          <button
            class="pagination-btn"
            [class.active]="currentPage === totalPages"
            (click)="onPageChange(totalPages)"
            *ngIf="shouldShowRightDots()"
          >
            {{ totalPages }}
          </button>

          <button
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="onPageChange(currentPage + 1)"
          >
            Next
          </button>

          <span class="pagination-info">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} -
            {{ Math.min(currentPage * itemsPerPage, totalItems) }} of
            {{ totalItems }} items
          </span>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div
      class="no-results"
      *ngIf="!isLoading && filteredCenters.length === 0 && centers.length > 0"
    >
      <p>No shopping centers match your search criteria.</p>
    </div>

    <!-- Empty State -->
    <div class="no-results" *ngIf="!isLoading && centers.length === 0">
      <p>No shopping centers available.</p>
    </div>
  </div>
</div>
<!-- File Explorer Component - Simplified integration -->
<app-file-explorer
  #fileExplorer
  [contactID]="contactID"
  (fileSelected)="onFileSelected($event)"
  (onClose)="onFileExplorerClose()"
>
</app-file-explorer>
