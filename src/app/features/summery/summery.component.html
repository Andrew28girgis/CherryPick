<div
  class="d-flex justify-content-between align-items-center mb-4"
  style="padding-left: 20px"
>
  <!-- Search Bar -->
  <div class="search-container">
    <div class="icon-input">
      <svg
        class="search-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
      >
        <path
          d="M11.5 21.75C5.85 21.75 1.25 17.15 1.25 11.5C1.25 5.85 5.85 1.25 11.5 1.25C17.15 1.25 21.75 5.85 21.75 11.5C21.75 17.15 17.15 21.75 11.5 21.75ZM11.5 2.75C6.67 2.75 2.75 6.68 2.75 11.5C2.75 16.32 6.67 20.25 11.5 20.25C16.33 20.25 20.25 16.32 20.25 11.5C20.25 6.68 16.33 2.75 11.5 2.75Z"
          fill="#777199"
        />
        <path
          d="M21.9999 22.7504C21.8099 22.7504 21.6199 22.6804 21.4699 22.5304L19.4699 20.5304C19.1799 20.2404 19.1799 19.7604 19.4699 19.4704C19.7599 19.1804 20.2399 19.1804 20.5299 19.4704L22.5299 21.4704C22.8199 21.7604 22.8199 22.2404 22.5299 22.5304C22.3799 22.6804 22.1899 22.7504 21.9999 22.7504Z"
          fill="#777199"
        />
      </svg>
      <input
        type="text"
        class="search-input"
        placeholder="Search..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="filterTenants()"
      />
    </div>
  </div>

  <!-- Filter and Sort Buttons -->
  <div class="d-flex gap-3 buttons-container">
    <button
      class="filter-btn"
      [ngClass]="{ active: showFilterDropdown }"
      (click)="toggleFilter($event)"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
      >
        <path
          d="M17.5 6.45801H2.5C2.15833 6.45801 1.875 6.17467 1.875 5.83301C1.875 5.49134 2.15833 5.20801 2.5 5.20801H17.5C17.8417 5.20801 18.125 5.49134 18.125 5.83301C18.125 6.17467 17.8417 6.45801 17.5 6.45801Z"
          fill="#777199"
        />
        <path
          d="M15 10.625H5C4.65833 10.625 4.375 10.3417 4.375 10C4.375 9.65833 4.65833 9.375 5 9.375H15C15.3417 9.375 15.625 9.65833 15.625 10C15.625 10.3417 15.3417 10.625 15 10.625Z"
          fill="#777199"
        />
        <path
          d="M11.6666 14.792H8.33325C7.99159 14.792 7.70825 14.5087 7.70825 14.167C7.70825 13.8253 7.99159 13.542 8.33325 13.542H11.6666C12.0083 13.542 12.2916 13.8253 12.2916 14.167C12.2916 14.5087 12.0083 14.792 11.6666 14.792Z"
          fill="#777199"
        />
      </svg>
      Filter
    </button>
    <button
      class="sort-btn"
      [ngClass]="{ active: showSortDropdown }"
      (click)="toggleSort($event)"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
      >
        <path
          d="M8.70844 6.22498C8.55011 6.22498 8.39175 6.16667 8.26675 6.04167L5.60841 3.38333L2.95008 6.04167C2.70841 6.28333 2.30841 6.28333 2.06675 6.04167C1.82508 5.8 1.82508 5.4 2.06675 5.15834L5.16677 2.05831C5.28344 1.94164 5.44175 1.875 5.60841 1.875C5.77508 1.875 5.93344 1.94164 6.05011 2.05831L9.15008 5.15834C9.39175 5.4 9.39175 5.8 9.15008 6.04167C9.02508 6.16667 8.86677 6.22498 8.70844 6.22498Z"
          fill="#777199"
        />
        <path
          d="M5.6084 18.125C5.26673 18.125 4.9834 17.8417 4.9834 17.5V2.5C4.9834 2.15833 5.26673 1.875 5.6084 1.875C5.95007 1.875 6.2334 2.15833 6.2334 2.5V17.5C6.2334 17.8417 5.95007 18.125 5.6084 18.125Z"
          fill="#777199"
        />
        <path
          d="M14.3999 18.1253C14.2333 18.1253 14.0749 18.0586 13.9582 17.942L10.8583 14.8419C10.6166 14.6003 10.6166 14.2003 10.8583 13.9586C11.0999 13.7169 11.4999 13.7169 11.7416 13.9586L14.3999 16.6169L17.0582 13.9586C17.2999 13.7169 17.6999 13.7169 17.9416 13.9586C18.1833 14.2003 18.1833 14.6003 17.9416 14.8419L14.8416 17.942C14.7249 18.0586 14.5583 18.1253 14.3999 18.1253Z"
          fill="#777199"
        />
        <path
          d="M14.3916 18.125C14.0499 18.125 13.7666 17.8417 13.7666 17.5V2.5C13.7666 2.15833 14.0499 1.875 14.3916 1.875C14.7333 1.875 15.0166 2.15833 15.0166 2.5V17.5C15.0166 17.8417 14.7416 18.125 14.3916 18.125Z"
          fill="#777199"
        />
      </svg>
      Sort
    </button>

    <!-- Filter Dropdown -->
    <div class="filter-dropdown" *ngIf="showFilterDropdown">
      <div class="filter-section">
        <h6>Asset Type</h6>
        <div class="filter-options">
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.fastFood"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Fast Food Brand
          </label>
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.sportswear"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Sport Wear
          </label>
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.luxury"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Luxury Brands
          </label>
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.fastFashion"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Fast Fashion
          </label>
        </div>
      </div>

      <div class="filter-section">
        <h6>Status</h6>
        <div class="filter-options">
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.active"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Active
          </label>
          <label class="custom-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="filters.inactive"
              (change)="filterTenants()"
            />
            <span class="checkmark"></span>
            Inactive
          </label>
        </div>
      </div>
    </div>

    <!-- Sort Dropdown -->
    <div class="sort-dropdown" *ngIf="showSortDropdown">
      <div class="sort-options">
        <div
          class="sort-option"
          (click)="sortTenants('alphabetical')"
          [class.active]="sortField === 'alphabetical'"
        >
          <span>Alphabetical</span>
          <svg
            *ngIf="sortField === 'alphabetical'"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
          >
            <path
              d="M16.6 12.5417L10.8833 6.82501C10.3917 6.33334 9.60833 6.33334 9.11667 6.82501L3.40002 12.5417"
              stroke="#18171F"
              stroke-width="1.5"
              stroke-miterlimit="10"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <!-- <div
          class="sort-option"
          (click)="sortTenants('newest')"
          [class.active]="sortField === 'newest'"
        >
          <span>Newest to Oldest</span>
          <svg
            *ngIf="sortField === 'newest'"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
          >
            <path
              d="M16.6 12.5417L10.8833 6.82501C10.3917 6.33334 9.60833 6.33334 9.11667 6.82501L3.40002 12.5417"
              stroke="#18171F"
              stroke-width="1.5"
              stroke-miterlimit="10"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div
          class="sort-option"
          (click)="sortTenants('oldest')"
          [class.active]="sortField === 'oldest'"
        >
          <span>Oldest to Newest</span>
          <svg
            *ngIf="sortField === 'oldest'"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
          >
            <path
              d="M16.6 12.5417L10.8833 6.82501C10.3917 6.33334 9.60833 6.33334 9.11667 6.82501L3.40002 12.5417"
              stroke="#18171F"
              stroke-width="1.5"
              stroke-miterlimit="10"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div> -->
      </div>
    </div>
  </div>
</div>

<div *ngIf="showCampaigns" style="padding: 0">
  <app-campaign-manager
    [viewMode]="campaignsViewMode"
    [hideViewToggles]="true"
    [forceReload]="!campaignsLoaded"
  >
  </app-campaign-manager>
</div>
<!-- Tenants container - show only when campaigns are not displayed -->
<div *ngIf="!showCampaigns" class="main-container">
  <div class="row" style="width: 1064px" *ngIf="!isLoading">
    <ng-container *ngFor="let tenant of filteredTenants">
      <div class="col-12 col-sm-6">
        <div class="card-kayak mt-3 mb-3" (click)="goToTenant(tenant)">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
              <div>
                <img
                  (click)="$event.stopPropagation()"
                  class="Kayak__img cursor"
                  [routerLink]="[
                    '/dashboard',
                    tenant.Id,
                    tenant.OrganizationId,
                    tenant.Name,
                    tenant.Campaigns ? tenant.Campaigns[0].Id : null
                  ]"
                  [src]="
                    'https://api.cherrypick.com/api/Organization/GetOrgImag?orgId=' +
                    tenant.OrganizationId
                  "
                  (error)="onImageError($event)"
                />
              </div>
              <div class="d-flex flex-column gap-2">
                <div class="active">
                  <div class="dot"></div>
                  <p class="text">Active</p>
                </div>

                <div
                  class="card__Kayak_title cursor"
                  [routerLink]="[
                    '/dashboard',
                    tenant.Id,
                    tenant.OrganizationId,
                    tenant.Name,
                    tenant.Campaigns ? tenant.Campaigns[0].Id : null
                  ]"
                >
                  {{ tenant.Name }}
                </div>
                <div
                  class="d-flex align-items-center gap-2 cursor"
                  data-bs-toggle="offcanvas"
                  [attr.data-bs-target]="'#campaignDetails' + tenant.Id"
                  aria-controls="campaignDetails"
                  (click)="$event.stopPropagation()"
                >
                  <ng-container
                    *ngIf="
                      tenant.Campaigns && tenant.Campaigns.length > 0;
                      else showSendButton
                    "
                  >
                    <span class="nomberofcampains">{{
                      tenant.Campaigns.length
                    }}</span>
                    <span class="campaingstext">Campaigns</span>
                    <img
                      src="../../../assets/Images/Icons/info.png"
                      alt="Info Icon"
                    />
                  </ng-container>

                  <ng-template #showSendButton>
                    <a
                      class="add-campaign"
                      [routerLink]="['/campaigns/add-campaign', tenant.Id]"
                    >
                    
                     Add Campaign
                    </a>
                  </ng-template>
                </div>
              </div>
            </div>
            <div
              class="chevronicon cursor"
              [routerLink]="[
                '/dashboard',
                tenant.Id,
                tenant.OrganizationId,
                tenant.Name,
                tenant.Campaigns ? tenant.Campaigns[0].Id : null
              ]"
            >
              <i class="fa-solid fa-chevron-right"></i>
            </div>
          </div>
        </div>
        <div
          class="offcanvas offcanvas-end"
          tabindex="-1"
          [id]="'campaignDetails' + tenant.Id"
          aria-labelledby="campaignDetailsLabel"
          (click)="$event.stopPropagation()"
        >
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="campaignDetailsLabel">
              <div class="d-flex align-items-center gap-3">
                <div>
                  <img
                    class="Kayak__img"
                    src="https://api.cherrypick.com/api/Organization/GetOrgImag?orgId={{
                      tenant.OrganizationId
                    }}"
                    alt=""
                  />
                </div>
                <div class="d-flex flex-column gap-2">
                  <div class="active">
                    <div class="dot"></div>
                    <p class="text">Active</p>
                  </div>

                  <div class="card__Kayak_title">
                    {{ tenant.Name }}
                  </div>
                </div>
              </div>
            </h5>
            <button
              type="button"
              class="btn-close text-reset"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>
          <div class="line"></div>

          <div class="offcanvas-body">
            <button
              class="offcanvas-addcampaign"
              [routerLink]="['/campaigns/add-campaign', tenant.Id]"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
              >
                <path
                  d="M6 12H18M12 18V6"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Add Campaign</span>
            </button>
            <div class="offcanvas-background">
              <ng-container *ngFor="let campaign of tenant.Campaigns">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex flex-column justify-content-center gap-1">
                    <div class="private">
                      <div class="privatedot"></div>
                      <p class="privatetext">Public</p>
                    </div>
                    <div
                      class="firsttradelist"
                      [routerLink]="[
                        '/dashboard',
                        tenant.Id,
                        tenant.OrganizationId,
                        tenant.Name,
                        campaign.Id
                      ]"
                    >
                      <span>{{ campaign.CampaignName }}</span>
                    </div>
                    <div class="graytext">
                      <span>{{ campaign.CreatedDate | date }}</span>
                    </div>
                  </div>
                </div>

                <div class="customline"></div>

                <div class="d-flex align-items-center justify-content-between">
                  <div class="graytext">
                    <span>Sites</span>
                  </div>
                  <div class="blackbold">
                    <span>{{ campaign.Sites }}</span>
                  </div>
                </div>
                <div class="d-flex align-items-center justify-content-between">
                  <div class="graytext">
                    <span>Mail Sent</span>
                  </div>
                  <div class="blackbold">
                    <span>{{ campaign.MailsSent }}</span>
                  </div>
                </div>

                <div class="CampaignWorkfow">
                  <span>Campaign Workflow</span>
                </div>

                <ng-container
                  *ngFor="let stage of campaign.Kanban; let first = first"
                >
                  <div *ngIf="!first" class="smallline"></div>
                  <div class="d-flex flex-column">
                    <div
                      class="d-flex align-items-center justify-content-between"
                    >
                      <div class="graytext">
                        <span>{{ stage.stageName }}</span>
                      </div>
                      <div class="blackbold">
                        <span>{{
                          stage.MarketSurveyShoppingCenters.length || 0
                        }}</span>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<button class="fab-button" (click)="openAddTenants()" *ngIf="!showCampaigns">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
  >
    <path
      d="M6 12H18M12 18V6"
      stroke="white"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</button>
