<div class="p-3 justify-content-between d-flex">
  <p class="m-0 f500" style="color: #000">
    {{ cardsSideList.length }} places within map area
  </p>
</div>

<div class="row m-0">
  <div class="col-8 p-0 d-flex flex-column cards-container">
    <div class="row m-0 mt-1" *ngIf="!isLoading; else loadingSkeleton">
      <ng-container *ngFor="let place of cardsSideList; trackBy: trackById">
        <div class="col-6">
          <div
            class="card-window cursor"
            (mouseenter)="onMouseHighlight(place)"
            (mouseleave)="onMouseLeaveHighlight(place)"
          >
          <div class="cardResponsive" *ngIf="place.MainImage">
            <div
              class="main-img"
              (click)="handleImageClick($event)"
              [routerLink]="(activeDropdownId || selectedIdCard === place?.Id) ? null : ['/landing',place?.ShoppingCenter?.Places?.[0]?.Id || 0,place?.Id,place.CampaignId]"
            >
              <img
                *ngIf="place.MainImage; else score"
                (error)="place.MainImage=null"
                loading="lazy"
                [src]="place.MainImage"
                [title]="place.CenterName"
                [ngClass]="{ loading: imageLoadingStates[place.Id] }"
                loading="lazy"
                alt="{{ place.CenterName }}"
                referrerpolicy="no-referrer"
                [class.click-disabled]="
                  place.isDropdownOpen || openOrgMenuId === place.Id
                "
                class="imgggg"
                [routerLink]="(activeDropdownId || selectedIdCard === place.Id) ? null : ['/landing',place?.ShoppingCenter?.Places?.[0]?.Id || 0,place?.Id,place.CampaignId]"
              />
              <div
              (click)="openInfoPopup(place, infoModal);$event.stopPropagation()"
              *ngIf="place.Score"
                class="card-badge"
                [ngClass]="{
                  'green-circle': place.Score > 50,
                  'yellow-circle': place.Score < 50,
                  'red-circle': !place.Score
                }"
                [attr.aria-label]="place.Score"
              >
                <span>{{ place.Score }} %</span>
              </div>
      
              <!--  White div with Score -->
              <ng-template #score>
                <div class="score-placeholder">
                  <div
                    class="score-text"
                    (click)="
                      $event.preventDefault();
                      $event.stopPropagation();
                      openInfoPopup(place, infoModal)
                    "
                  >
                    {{ place.Score | number : "1.0-0" }}%
                  </div>
                  <button
                    (click)="
                      $event.preventDefault();
                      $event.stopPropagation();
                      openInfoPopup(place, infoModal)
                    "
                    class="icon-btn"
                  >
                    <i class="fa-solid fa-circle-info"></i>
                  </button>
                </div>
              </ng-template>
              <!-- Overlayed stage chip on image -->
              <div class="img-overlay" *ngIf="place.stageName">
                <div class="custom-dropdown">
                  <div
                    class="selected-option"
                    (click)="toggleDropdown(place, $event)"
                  >
                    {{ getSelectedStageName(place.kanbanStageId) }}
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                    >
                      <path
                        d="M8.00001 11.2C7.53335 11.2 7.06668 11.0201 6.71335 10.6667L2.36668 6.32005C2.17335 6.12672 2.17335 5.80672 2.36668 5.61338C2.56001 5.42005 2.88001 5.42005 3.07335 5.61338L7.42001 9.96005C7.74001 10.2801 8.26001 10.2801 8.58001 9.96005L12.9267 5.61338C13.12 5.42005 13.44 5.42005 13.6333 5.61338C13.8267 5.80672 13.8267 6.12672 13.6333 6.32005L9.28668 10.6667C8.93335 11.0201 8.46668 11.2 8.00001 11.2Z"
                        fill="#161017"
                      />
                    </svg>
                  </div>
                  <div
                    class="dropdown-options"
                    [class.show]="place.isDropdownOpen"
                  >
                    <div
                      *ngFor="let stage of KanbanStages"
                      class="dropdown-item"
                      [class.active]="stage.id === place.kanbanStageId"
                      (click)="
                        selectStage(
                          place.MarketSurveyId,
                          stage.id,
                          place,
                          $event
                        )
                      "
                    >
                      {{ stage.stageName }}
                    </div>
                  </div>
                </div>
                <div class="pb-2">
                  <div
                    class="relativee"
                    style="display: flex; justify-content: end; gap: 5px"
                  >
                    <button
                      class="ellipsis_icont"
                      (click)="
                        activeDropdownId
                          ? handleEllipsisClick($event)
                          : toggleShortcutsCard(place.Id, $event)
                      "
                    >
                      <i class="fa-solid fa-ellipsis"></i>
                    </button>
                    <div
                      class="shortcuts_iconCard"
                      *ngIf="selectedIdCard === place?.Id"
                    >
                      <ul>
                        <li>
                          <a
                            class="target"
                            (click)="openInfoPopup(place, infoModal)"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="25"
                              height="24"
                              viewBox="0 0 25 24"
                              fill="none"
                            >
                              <path
                                d="M8.58374 15.27L15.1237 8.72998"
                                stroke="#292D32"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                              />
                              <path
                                d="M8.99368 10.37C9.67299 10.37 10.2237 9.81936 10.2237 9.14005C10.2237 8.46073 9.67299 7.91003 8.99368 7.91003C8.31437 7.91003 7.76367 8.46073 7.76367 9.14005C7.76367 9.81936 8.31437 10.37 8.99368 10.37Z"
                                stroke="#292D32"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                              />
                              <path
                                d="M15.5337 16.09C16.213 16.09 16.7637 15.5393 16.7637 14.86C16.7637 14.1807 16.213 13.63 15.5337 13.63C14.8544 13.63 14.3037 14.1807 14.3037 14.86C14.3037 15.5393 14.8544 16.09 15.5337 16.09Z"
                                stroke="#292D32"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                              />
                              <path
                                d="M12.0137 22C17.5365 22 22.0137 17.5228 22.0137 12C22.0137 6.47715 17.5365 2 12.0137 2C6.49082 2 2.01367 6.47715 2.01367 12C2.01367 17.5228 6.49082 22 12.0137 22Z"
                                stroke="#292D32"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                              />
                            </svg>
                            Show Score
                          </a>
                        </li>
                        <li (click)="toggleShortcuts(place.Id, 'close')">
                          <a
                            class="target"
                            href="https://www.google.com/search?q=leasing manager for+{{
                              place.CenterName
                            }}+{{ place.CenterAddress }}+{{
                              place.CenterCity
                            }}+{{ place.CenterState }}+{{
                              place.ZipCode
                            }}&rlz=1C1FHFK_enEG1100EG1100&oq=city+center&gs_lcrp=EgZjaHJvbWUqCggAEAAYsQMYgAQyDAgAEEUYORixAxiABDIKCAEQABixAxiABDINCAIQLhivARjHARiABDIHCAMQABiABDIKCAQQABixAxiABDINCAUQLhivARjHARiABDIHCAYQABiABDIHCAcQABiABDINCAgQLhivARjHARiABDIHCAkQABiABNIBCDM4MjNqMGo3qAIAsAIA&sourceid=chrome&ie=UTF-8&address={{
                              place.CenterAddress
                            }},{{ place.CenterCity }},{{ place.CenterState }},{{
                              place.ZipCode
                            }}&shoppingCenterName={{
                              place.CenterName
                            }}&organizationId={{ orgId }}&organizationName={{
                              orgName
                            }}&campaignId={{ cId }}"
                            target="_blank"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                            >
                              <path
                                d="M9.58332 18.1248C4.87499 18.1248 1.04166 14.2915 1.04166 9.58317C1.04166 4.87484 4.87499 1.0415 9.58332 1.0415C14.2917 1.0415 18.125 4.87484 18.125 9.58317C18.125 14.2915 14.2917 18.1248 9.58332 18.1248ZM9.58332 2.2915C5.55832 2.2915 2.29166 5.5665 2.29166 9.58317C2.29166 13.5998 5.55832 16.8748 9.58332 16.8748C13.6083 16.8748 16.875 13.5998 16.875 9.58317C16.875 5.5665 13.6083 2.2915 9.58332 2.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M18.3333 18.9585C18.175 18.9585 18.0167 18.9002 17.8917 18.7752L16.225 17.1085C15.9833 16.8669 15.9833 16.4669 16.225 16.2252C16.4667 15.9835 16.8667 15.9835 17.1083 16.2252L18.775 17.8919C19.0167 18.1335 19.0167 18.5335 18.775 18.7752C18.65 18.9002 18.4917 18.9585 18.3333 18.9585Z"
                                fill="#704E73"
                              />
                            </svg>
                            Google Search
                          </a>
                        </li>
                        <li
                          *ngIf="
                            place?.ShoppingCenter?.ManagerOrganization?.length
                          "
                        >
                          <a class="target" (click)="openContactModal(place)">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                            >
                              <path
                                d="M10 10.6248C7.35834 10.6248 5.20834 8.47484 5.20834 5.83317C5.20834 3.1915 7.35834 1.0415 10 1.0415C12.6417 1.0415 14.7917 3.1915 14.7917 5.83317C14.7917 8.47484 12.6417 10.6248 10 10.6248ZM10 2.2915C8.05001 2.2915 6.45834 3.88317 6.45834 5.83317C6.45834 7.78317 8.05001 9.37484 10 9.37484C11.95 9.37484 13.5417 7.78317 13.5417 5.83317C13.5417 3.88317 11.95 2.2915 10 2.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M17.1585 18.9583C16.8168 18.9583 16.5335 18.675 16.5335 18.3333C16.5335 15.4583 13.6001 13.125 10.0001 13.125C6.40013 13.125 3.4668 15.4583 3.4668 18.3333C3.4668 18.675 3.18346 18.9583 2.8418 18.9583C2.50013 18.9583 2.2168 18.675 2.2168 18.3333C2.2168 14.775 5.70846 11.875 10.0001 11.875C14.2918 11.875 17.7835 14.775 17.7835 18.3333C17.7835 18.675 17.5001 18.9583 17.1585 18.9583Z"
                                fill="#704E73"
                              />
                            </svg>
                            Contact Broker
                          </a>
                        </li>
      
                        <li>
                          <a class="target" (click)="finContactMessage(place)">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                            >
                              <path
                                d="M10 10.6248C7.35834 10.6248 5.20834 8.47484 5.20834 5.83317C5.20834 3.1915 7.35834 1.0415 10 1.0415C12.6417 1.0415 14.7917 3.1915 14.7917 5.83317C14.7917 8.47484 12.6417 10.6248 10 10.6248ZM10 2.2915C8.05001 2.2915 6.45834 3.88317 6.45834 5.83317C6.45834 7.78317 8.05001 9.37484 10 9.37484C11.95 9.37484 13.5417 7.78317 13.5417 5.83317C13.5417 3.88317 11.95 2.2915 10 2.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M17.1585 18.9583C16.8168 18.9583 16.5335 18.675 16.5335 18.3333C16.5335 15.4583 13.6001 13.125 10.0001 13.125C6.40013 13.125 3.4668 15.4583 3.4668 18.3333C3.4668 18.675 3.18346 18.9583 2.8418 18.9583C2.50013 18.9583 2.2168 18.675 2.2168 18.3333C2.2168 14.775 5.70846 11.875 10.0001 11.875C14.2918 11.875 17.7835 14.775 17.7835 18.3333C17.7835 18.675 17.5001 18.9583 17.1585 18.9583Z"
                                fill="#704E73"
                              />
                            </svg>
                            Find Broker
                          </a>
                        </li>
                        <li>
                          <a
                            class="target"
                            (click)="
                              requestCenterStatus(place.Id, place.CampaignId)
                            "
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                            >
                              <path
                                d="M9.99999 18.9582C5.05832 18.9582 1.04166 14.9415 1.04166 9.99984C1.04166 5.05817 5.05832 1.0415 9.99999 1.0415C14.9417 1.0415 18.9583 5.05817 18.9583 9.99984C18.9583 14.9415 14.9417 18.9582 9.99999 18.9582ZM9.99999 2.2915C5.74999 2.2915 2.29166 5.74984 2.29166 9.99984C2.29166 14.2498 5.74999 17.7082 9.99999 17.7082C14.25 17.7082 17.7083 14.2498 17.7083 9.99984C17.7083 5.74984 14.25 2.2915 9.99999 2.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M8.81667 12.9832C8.65 12.9832 8.49167 12.9165 8.375 12.7998L6.01667 10.4415C5.775 10.1998 5.775 9.79984 6.01667 9.55817C6.25834 9.3165 6.65834 9.3165 6.9 9.55817L8.81667 11.4748L13.1 7.1915C13.3417 6.94984 13.7417 6.94984 13.9833 7.1915C14.225 7.43317 14.225 7.83317 13.9833 8.07484L9.25834 12.7998C9.14167 12.9165 8.98334 12.9832 8.81667 12.9832Z"
                                fill="#704E73"
                              />
                            </svg>
                            Center Status</a
                          >
                        </li>
                        <!-- <app-add-contact [shoppingCenterId]="selectedShoppingCenterId" #addContactModal></app-add-contact> -->
      
                        <li (click)="openAddContactModal(place.Id)">
                          <a class="target">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                            >
                              <path
                                d="M10 10.6248C7.35834 10.6248 5.20834 8.47484 5.20834 5.83317C5.20834 3.1915 7.35834 1.0415 10 1.0415C12.6417 1.0415 14.7917 3.1915 14.7917 5.83317C14.7917 8.47484 12.6417 10.6248 10 10.6248ZM10 2.2915C8.05001 2.2915 6.45834 3.88317 6.45834 5.83317C6.45834 7.78317 8.05001 9.37484 10 9.37484C11.95 9.37484 13.5417 7.78317 13.5417 5.83317C13.5417 3.88317 11.95 2.2915 10 2.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M2.8418 18.9583C2.50013 18.9583 2.2168 18.675 2.2168 18.3333C2.2168 14.775 5.70846 11.875 10.0001 11.875C10.8418 11.875 11.6668 11.9834 12.4668 12.2084C12.8001 12.3 12.9918 12.6417 12.9001 12.975C12.8085 13.3083 12.4668 13.5 12.1335 13.4084C11.4501 13.2167 10.7335 13.125 10.0001 13.125C6.40013 13.125 3.4668 15.4583 3.4668 18.3333C3.4668 18.675 3.18346 18.9583 2.8418 18.9583Z"
                                fill="#704E73"
                              />
                              <path
                                d="M15 18.9582C14.0167 18.9582 13.0833 18.5915 12.3583 17.9332C12.0666 17.6832 11.8083 17.3748 11.6083 17.0332C11.2417 16.4332 11.0417 15.7248 11.0417 14.9998C11.0417 13.9582 11.4417 12.9832 12.1583 12.2415C12.9083 11.4665 13.9167 11.0415 15 11.0415C16.1333 11.0415 17.2083 11.5249 17.9417 12.3582C18.5917 13.0832 18.9583 14.0165 18.9583 14.9998C18.9583 15.3165 18.9167 15.6332 18.8333 15.9332C18.75 16.3082 18.5916 16.6998 18.375 17.0415C17.6833 18.2248 16.3833 18.9582 15 18.9582ZM15 12.2915C14.2583 12.2915 13.575 12.5832 13.0583 13.1082C12.5667 13.6165 12.2917 14.2832 12.2917 14.9998C12.2917 15.4915 12.425 15.9748 12.6833 16.3915C12.8167 16.6248 12.9916 16.8331 13.1916 17.0081C13.6916 17.4665 14.3333 17.7165 15 17.7165C15.9417 17.7165 16.8333 17.2165 17.3167 16.4082C17.4583 16.1748 17.5667 15.9082 17.625 15.6499C17.6833 15.4332 17.7083 15.2248 17.7083 15.0082C17.7083 14.3415 17.4583 13.6999 17.0083 13.1999C16.5083 12.6165 15.775 12.2915 15 12.2915Z"
                                fill="#704E73"
                              />
                              <path
                                d="M16.2498 15.6084H13.7581C13.4165 15.6084 13.1331 15.3251 13.1331 14.9834C13.1331 14.6417 13.4165 14.3584 13.7581 14.3584H16.2498C16.5915 14.3584 16.8748 14.6417 16.8748 14.9834C16.8748 15.3251 16.5915 15.6084 16.2498 15.6084Z"
                                fill="#704E73"
                              />
                              <path
                                d="M15 16.8833C14.6583 16.8833 14.375 16.5999 14.375 16.2583V13.7666C14.375 13.4249 14.6583 13.1416 15 13.1416C15.3417 13.1416 15.625 13.4249 15.625 13.7666V16.2583C15.625 16.6083 15.3417 16.8833 15 16.8833Z"
                                fill="#704E73"
                              />
                            </svg>
                            Add Contact
                          </a>
                        </li>
                        <li *ngIf="place.Deleted == true">
                          <a
                            class="target"
                            (click)="
                              RestoreShoppingCenter(
                                place.MarketSurveyId,
                                place.Deleted,
                                place.Id
                              )
                            "
                          >
                            <i class="fa-solid fa-trash-arrow-up emily"></i>
                            Restore
                          </a>
                        </li>
                      </ul>
                      <i class="fa-solid fa-caret-up"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="-container"></div>
      
            <div class="content-wrap card-content">
              <div>
                <div
                  class="d-flex justify-content-between"
                  [routerLink]="[ '/landing', place?.ShoppingCenter?.Places ? place?.ShoppingCenter?.Places?.[0]?.Id : 0,place?.Id,place.CampaignId]"
                >
                  <div class="content-title cursor" style="white-space: pre-line">
                    {{ place.CenterName }}
                  </div>
                  <span
                    class="badge badge-danger mx-2"
                    *ngIf="place.Deleted == true"
                    >Deleted</span
                  >
                </div>
                <div
                  class="card-address cursor"
                  (click)="openMapViewPlace(MapViewPlace, place)"
                  title="View Location"
                  style="cursor: pointer"
                >
                  <span class="mb-5">
                    {{ place.CenterAddress }},
                    {{ place.CenterCity | titlecase }},
                    {{ place.CenterState }}
                  </span>
                </div>
      
                <div
                  *ngIf="
                    place.sizeRange !== null && place.sizeRange !== undefined
                  "
                >
                  <ng-container
                    *ngIf="Array.isArray(place.sizeRange); else singleSize"
                  >
                    {{ place.sizeRange[0] | number }} -
                    {{ place.sizeRange[1] | number }} SF
                  </ng-container>
                  <ng-template #singleSize>
                    {{ place.sizeRange | number }} SF
                  </ng-template>
                </div>
      
                <div>
                  <div
                    *ngIf="place.ShoppingCenter?.Places?.length"
                    class="table-responsive mt-2"
                    style="max-height: 150px; overflow-y: auto"
                  ></div>
      
                 
                  <div *ngIf="getSentMails(place).length > 0" class="mt-2">
                    <ng-container *ngIf="getSentMails(place) as mails">
                      <div *ngIf="place.lastOutgoingEmail">
                        <span
                          class="mail-summary"
                          (click)="openMailPopup(place.lastOutgoingEmail.ID)"
                        >
                          Last Sent Email:
                          <span style="text-decoration: none">{{
                            place.lastOutgoingEmail.Date | date
                          }}</span>
                        </span>
                      </div>
                      <div *ngIf="place.lastIncomingEmail" class="mt-2">
                        <span
                          class="mail-summary"
                          (click)="openMailPopup(place.lastIncomingEmail.ID)"
                          modal-body              >
                          Last Received Email:
                          <span style="text-decoration: none">{{
                            place.lastIncomingEmail.Date | date
                          }}</span>
                        </span>
                      </div>
                    </ng-container>
                  </div>
                </div>
                <div class="row m-0">
                  <div
                    *ngFor="let item of place.ShoppingCenter?.BuyBoxPlaces"
                    class="col-12 d-flex flex-column spec"
                  >
                    <div class="d-flex flex-column">
                      <p class="nearset-category">
                        <b>{{ getNeareastCategoryName(item.CategoryId) }} </b>
                      </p>
                      <p>
                        {{ item.RelationOrganizationName }}
                        <!-- <img loading="lazy" 
                            class="logo ms-2"
                            src="https://api.cherrypick.com/api/Organization/GetOrgImag?orgId={{
                              item.RelationOrganizationId
                            }}"
                            [title]="item.RelationOrganizationName"
                            alt=""
                          /> -->
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-12 spec">
                <!-- <hr class="small-hr mt-1 mb-1" /> -->
                <div
                  class="spec-head between"
                  *ngIf="
                    place.ShoppingCenter?.ManagerOrganization;
                    else findContacts
                  "
                ></div>
      
                <ng-template #findContacts>
                  <!-- <a
                      class="target"
                      href="https://www.google.com/search?q=leasing manager for+{{
                        place.CenterName
                      }}+{{ place.CenterAddress }}+{{ place.CenterCity }}+{{
                        
                        place.CenterState
                      }}+{{
                        place.ZipCode
                      }}&rlz=1C1FHFK_enEG1100EG1100&oq=city+center&gs_lcrp=EgZjaHJvbWUqCggAEAAYsQMYgAQyDAgAEEUYORixAxiABDIKCAEQABixAxiABDINCAIQLhivARjHARiABDIHCAMQABiABDIKCAQQABixAxiABDINCAUQLhivARjHARiABDIHCAYQABiABDIHCAcQABiABDINCAgQLhivARjHARiABDIHCAkQABiABNIBCDM4MjNqMGo3qAIAsAIA&sourceid=chrome&ie=UTF-8&address={{
                        place.CenterAddress
                      }},{{ place.CenterCity }},{{ place.CenterState }},{{
                        place.ZipCode
                      }}&shoppingCenterName={{
                        place.CenterName
                      }}&organizationId={{ orgId }}&organizationName={{
                        orgName
                      }}&campaignId={{ cId }}"
                      target="_blank"
                      (click)="
                        finContactMessage(
                          place.Id,
                          place.CenterName,
                          place.CenterAddress
                        )
                      "
                    >
                      Find Contacts
                    </a> -->
                  <!-- <button
                      class="btn find-broker-btn"
                      (click)="finContactMessage(shopping)"
                    >
                      Find Broker
                    </button> -->
                </ng-template>
              </div>
      
              <button
                *ngIf="checkSubmission(place?.ShoppingCenter?.UserSubmmision)"
                class="submission-button"
                (click)="
                  openModalSubmission(
                    place?.ShoppingCenter?.UserSubmmision || [],
                    submission
                  )
                "
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-file-icon lucide-file"
                >
                  <path
                    d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"
                  />
                  <path d="M14 2v4a2 2 0 0 0 2 2h4" />
                </svg>
                View Submissions
              </button>
            </div>
            <div class="stats">
              <div>
                <div
                  class="leased-by"
                  *ngIf="place?.ShoppingCenter?.ManagerOrganization?.length"
                  (click)="
                    toggleOrgMenu(place.Id, $event); $event.stopPropagation()
                  "
                >
                  <img *ngIf="place.ManagerORGLogoURL" src="{{place.ManagerORGLogoURL}}" alt="" width="30" height="30" class="mx-1"/>
                  <span class="MangerORG"> {{ place?.ManagerORG || "â€”" }}</span>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <path
                      d="M11.9999 16.3299C9.60992 16.3299 7.66992 14.3899 7.66992 11.9999C7.66992 9.60992 9.60992 7.66992 11.9999 7.66992C14.3899 7.66992 16.3299 9.60992 16.3299 11.9999C16.3299 14.3899 14.3899 16.3299 11.9999 16.3299ZM11.9999 9.16992C10.4399 9.16992 9.16992 10.4399 9.16992 11.9999C9.16992 13.5599 10.4399 14.8299 11.9999 14.8299C13.5599 14.8299 14.8299 13.5599 14.8299 11.9999C14.8299 10.4399 13.5599 9.16992 11.9999 9.16992Z"
                      fill="#292D32"
                    />
                    <path
                      d="M12.0001 21.02C8.24008 21.02 4.69008 18.82 2.25008 15C1.19008 13.35 1.19008 10.66 2.25008 8.99998C4.70008 5.17998 8.25008 2.97998 12.0001 2.97998C15.7501 2.97998 19.3001 5.17998 21.7401 8.99998C22.8001 10.65 22.8001 13.34 21.7401 15C19.3001 18.82 15.7501 21.02 12.0001 21.02ZM12.0001 4.47998C8.77008 4.47998 5.68008 6.41998 3.52008 9.80998C2.77008 10.98 2.77008 13.02 3.52008 14.19C5.68008 17.58 8.77008 19.52 12.0001 19.52C15.2301 19.52 18.3201 17.58 20.4801 14.19C21.2301 13.02 21.2301 10.98 20.4801 9.80998C18.3201 6.41998 15.2301 4.47998 12.0001 4.47998Z"
                      fill="#292D32"
                    />
                  </svg>
                  <!-- trigger -->
                  <div class="org-info-trigger">
                    <div
                      class="org-mini-menu"
                      *ngIf="openOrgMenuId === place.Id"
                      [ngStyle]="orgMenuPos"
                      (click)="$event.stopPropagation()"
                    >
                      <div
                        *ngFor="
                          let org of place.ShoppingCenter.ManagerOrganization;
                          let i = index
                        "
                        class="org-mini-item"
                      >
                        <p class="name">
                          {{ org.Firstname | titlecase }}
                          {{ org.LastName | titlecase }}
                        </p>
                        <p class="small">{{ org.CellPhone }}</p>
                        <p class="small">{{ org.Email }}</p>
                        <div
                          class="divider"
                          *ngIf="
                            i < place.ShoppingCenter.ManagerOrganization.length - 1
                          "
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
      
              <div class="actions">
                <div class="pdf" *ngIf="place?.DocsLink">
                  <a
                    class="info-value text-dark"
                    href="{{ place.DocsLink }}"
                    target="_blank"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M15 22.75H9C3.57 22.75 1.25 20.43 1.25 15V9C1.25 3.57 3.57 1.25 9 1.25H14C14.41 1.25 14.75 1.59 14.75 2C14.75 2.41 14.41 2.75 14 2.75H9C4.39 2.75 2.75 4.39 2.75 9V15C2.75 19.61 4.39 21.25 9 21.25H15C19.61 21.25 21.25 19.61 21.25 15V10C21.25 9.59 21.59 9.25 22 9.25C22.41 9.25 22.75 9.59 22.75 10V15C22.75 20.43 20.43 22.75 15 22.75Z"
                        fill="#292D32"
                      />
                      <path
                        d="M22 10.75H18C14.58 10.75 13.25 9.41999 13.25 5.99999V1.99999C13.25 1.69999 13.43 1.41999 13.71 1.30999C13.99 1.18999 14.31 1.25999 14.53 1.46999L22.53 9.46999C22.74 9.67999 22.81 10.01 22.69 10.29C22.57 10.57 22.3 10.75 22 10.75ZM14.75 3.80999V5.99999C14.75 8.57999 15.42 9.24999 18 9.24999H20.19L14.75 3.80999Z"
                        fill="#292D32"
                      />
                    </svg>
                  </a>
                </div>
      
                <div class="street-view">
                  <a
                    class="target"
                    (click)="openStreetViewPlace(StreetViewPlace, place)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                    >
                      <path
                        d="M12.875 10.4795C13.4656 10.6906 13.9543 10.9406 14.3145 11.2207C14.7916 11.5918 15 11.9774 15 12.375C15 12.7171 14.8475 13.0452 14.5088 13.3652C14.1632 13.6916 13.6427 13.989 12.9736 14.2383C11.637 14.7362 9.82503 15 8 15C6.17497 15 4.36301 14.7362 3.02637 14.2383C2.35725 13.989 1.83682 13.6916 1.49121 13.3652C1.15247 13.0452 1 12.7171 1 12.375C1 11.9774 1.20837 11.5918 1.68555 11.2207C2.0457 10.9406 2.53444 10.6906 3.125 10.4795V10.752C2.65623 10.925 2.25971 11.1182 1.95801 11.3262C1.77158 11.4547 1.60411 11.5983 1.47949 11.7598C1.3564 11.9192 1.25 12.1291 1.25 12.375C1.25 12.6094 1.34695 12.8109 1.46191 12.9668C1.57781 13.1239 1.73351 13.2641 1.90625 13.3887C2.25197 13.6379 2.73008 13.8684 3.30371 14.0654C4.45653 14.4614 6.07492 14.75 8 14.75C9.92508 14.75 11.5435 14.4614 12.6963 14.0654C13.2699 13.8684 13.748 13.6379 14.0938 13.3887C14.2665 13.2641 14.4222 13.1239 14.5381 12.9668C14.653 12.8109 14.75 12.6094 14.75 12.375C14.75 12.1291 14.6436 11.9192 14.5205 11.7598C14.3959 11.5983 14.2284 11.4547 14.042 11.3262C13.7403 11.1182 13.3438 10.925 12.875 10.752V10.4795ZM8 5C6.68138 5 5.625 6.05638 5.625 7.375V9.79297L5.90137 9.93164L6.875 10.418V12.875H9.125V10.418L10.0986 9.93164L10.375 9.79297V7.375C10.375 6.05638 9.31862 5 8 5ZM8 1.25C7.02562 1.25 6.25 2.02562 6.25 3C6.25 3.97438 7.02562 4.75 8 4.75C8.97438 4.75 9.75 3.97438 9.75 3C9.75 2.02562 8.97438 1.25 8 1.25ZM6.625 10.582L6.34863 10.4434L5.375 9.95605V7.375C5.375 6.47551 5.83943 5.66741 6.54199 5.19141L7.04883 4.84766L6.61133 4.41992C6.23466 4.05112 6 3.54923 6 3C6 1.90163 6.90163 1 8 1C9.09837 1 10 1.90163 10 3C10 3.54923 9.76534 4.05112 9.38867 4.41992L8.95117 4.84766L9.45801 5.19141C10.1606 5.66741 10.625 6.47551 10.625 7.375V9.95605L9.65137 10.4434L9.375 10.582V13.125H6.625V10.582Z"
                        fill="#161017"
                        stroke="#161017"
                      />
                    </svg>
                  </a>
                </div>
                <div class="map-view">
                  <a
                    class="target"
                    (click)="openMapViewPlace(MapViewPlace, place)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M20.3799 21.13C20.1799 21.13 19.9899 21.05 19.8499 20.91L13.4699 14.53C13.1799 14.24 13.1799 13.76 13.4699 13.47L21.2 5.74001C21.39 5.55001 21.6799 5.48001 21.9399 5.55001C22.1999 5.63001 22.3999 5.84001 22.4599 6.10001C22.6499 6.95001 22.7499 7.90001 22.7499 9.00001V15C22.7499 17.77 22.1699 19.64 20.9099 20.91C20.7699 21.05 20.5599 21.08 20.3799 21.13ZM15.0599 14L20.3199 19.26C20.9499 18.29 21.2499 16.91 21.2499 15V9.00001C21.2499 8.59001 21.2399 8.21001 21.2099 7.85001L15.0599 14Z"
                        fill="#292D32"
                      />
                      <path
                        d="M6.26999 22.48C6.20999 22.48 6.16001 22.47 6.10001 22.46C2.79001 21.7 1.25 19.33 1.25 15V9C1.25 3.57 3.57 1.25 9 1.25H15C19.33 1.25 21.7 2.79001 22.46 6.10001C22.52 6.35001 22.44 6.62 22.26 6.8L6.79999 22.26C6.65999 22.4 6.46999 22.48 6.26999 22.48ZM9 2.75C4.39 2.75 2.75 4.39 2.75 9V15C2.75 18.47 3.71001 20.21 6.04001 20.9L20.89 6.05C20.21 3.72 18.46 2.75999 14.99 2.75999H9V2.75Z"
                        fill="#292D32"
                      />
                      <path
                        d="M14.9999 22.7499H8.99989C7.89989 22.7499 6.95989 22.6599 6.09989 22.4599C5.82989 22.3999 5.61987 22.1999 5.54987 21.9399C5.46987 21.6799 5.54988 21.3999 5.73988 21.1999L13.4699 13.4699C13.7599 13.1799 14.2399 13.1799 14.5299 13.4699L20.9099 19.8499C21.0499 19.9899 21.1299 20.1799 21.1299 20.3799C21.1299 20.5799 21.0499 20.7699 20.9099 20.9099C19.6399 22.1699 17.7699 22.7499 14.9999 22.7499ZM7.84989 21.2099C8.20989 21.2399 8.58989 21.2499 8.99989 21.2499H14.9999C16.9199 21.2499 18.2899 20.9499 19.2599 20.3199L13.9999 15.0599L7.84989 21.2099Z"
                        fill="#292D32"
                      />
                      <path
                        d="M9.11994 13.31C8.48994 13.31 7.85993 13.08 7.35993 12.61C5.76993 11.1 5.12996 9.44005 5.50996 7.82005C5.88996 6.16005 7.33994 5.04004 9.11994 5.04004C10.8999 5.04004 12.35 6.16005 12.73 7.82005C13.1 9.45005 12.4599 11.1 10.8699 12.61C10.3799 13.07 9.74994 13.31 9.11994 13.31ZM6.96995 8.15004C6.64995 9.51004 7.56994 10.7301 8.39994 11.5201C8.80994 11.91 9.43994 11.91 9.83994 11.5201C10.6599 10.7401 11.5799 9.52004 11.2699 8.15004C10.9999 6.96004 9.93994 6.53004 9.11994 6.53004C8.29994 6.53004 7.24995 6.96004 6.96995 8.15004Z"
                        fill="#292D32"
                      />
                      <path
                        d="M9.1499 9.49023C8.5999 9.49023 8.1499 9.04023 8.1499 8.49023C8.1499 7.94023 8.5899 7.49023 9.1499 7.49023H9.15991C9.70991 7.49023 10.1599 7.94023 10.1599 8.49023C10.1599 9.04023 9.6999 9.49023 9.1499 9.49023Z"
                        fill="#292D32"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="col-4">
    <ng-container *ngIf="isLoading; else mapContent">
      <div class="skeleton-map h700"></div>
    </ng-container>
    <ng-template #mapContent>
      <div id="map" class="custom-map"></div>
    </ng-template>
  </div>

   <ng-template #MapViewPlace let-modal>
    <div id="mappopup" class="h700"></div>
  </ng-template>
  <ng-template #ShareLink let-modal>
    <div class="d-flex p-3 m-3 align-items-center">
      <p>{{ shareLink }}</p>
      <i class="fa-solid fa-copy ms-3 cursor" (click)="copyLink(shareLink)"></i>
    </div>
  </ng-template>

  <ng-template #StreetViewPlace let-modal>
    <div *ngIf="General.modalObject.StreetViewURL">
      <iframe
        [src]="sanitizedUrl"
        height="700"
        width="798px"
        class="sanitizedUrl"
        allowfullscreen=""
      >
      </iframe>
    </div>
    <div
      id="street-view"
      class="h700"
      *ngIf="!General.modalObject.StreetViewURL"
    ></div>
  </ng-template>

  <ng-template #deleteSingleShoppingCenterModal let-modal>
    <div class="modal-body-general p-4 rounded deleteShopping">
      <h2 class="text-center mb-4 RemoveShopping">Remove Shopping Center</h2>
      <p class="text-center Areyou">
        Are you sure you want to remove this Shopping Center?
      </p>

      <div class="d-flex justify-content-end mt-4">
        <button
          type="button"
          class="btn btn-secondary me-2 px-4 py-2 btnborder"
          (click)="modal.dismiss('Cancel click')"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-danger px-4 py-2 btnborder"
          (click)="deleteShCenter()"
        >
          Remove
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #statusModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Center Status</h5>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="modal.dismiss()"
      ></button>
    </div>
    <div class="modal-body">
      <!-- Render the skeleton loader or fetched content -->
      <div *ngIf="isLoadingstatus; else contentTemplate">
        <div class="skeleton-loader">
          <div
            class="skeleton-head"
            style="
              height: 24px;
              width: 40%;
              margin-bottom: 16px;
              border-radius: 4px;
              background-color: #e0e0e0;
            "
          ></div>
          <div class="skeleton-paragraph">
            <div
              class="skeleton-line"
              style="
                height: 16px;
                width: 100%;
                margin-bottom: 8px;
                border-radius: 4px;
                background-color: #e0e0e0;
              "
            ></div>
            <div
              class="skeleton-line"
              style="
                height: 16px;
                width: 95%;
                margin-bottom: 8px;
                border-radius: 4px;
                background-color: #e0e0e0;
              "
            ></div>
            <div
              class="skeleton-line"
              style="
                height: 16px;
                width: 90%;
                border-radius: 4px;
                background-color: #e0e0e0;
              "
            ></div>
          </div>
        </div>
      </div>
      <ng-template #contentTemplate>
        <div [innerHTML]="htmlContent"></div>
      </ng-template>
    </div>
  </ng-template>

  <ng-template #loadingSkeleton>
    <div class="row m-0 mt-1">
      <ng-container *ngFor="let _ of skeletonItems">
        <div class="col-6 skeleton-col">
          <div class="card-window total skeleton-card">
            <div class="card-window_c skeleton">
              <div class="main-img">
                <div class="skeleton-image"></div>
              </div>
              <div class="content-wrap card-content skeleton-content">
                <div class="skeleton-text skeleton-title"></div>
                <div class="skeleton-text skeleton-line"></div>
                <div class="skeleton-text skeleton-line short"></div>
                <div class="skeleton-text skeleton-line"></div>
                <div class="skeleton-text skeleton-line short"></div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #submission let-modal>
    <div class="modal-header d-flex justify-content-between">
      <h4 class="modal-title">Submissions</h4>
      <button
        type="button"
        class="close"
        style="background: none; border: none"
        aria-label="Close"
        (click)="modal.dismiss()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
        >
          <path
            d="M12 22.75C6.07 22.75 1.25 17.93 1.25 12C1.25 6.07 6.07 1.25 12 1.25C17.93 1.25 22.75 6.07 22.75 12C22.75 17.93 17.93 22.75 12 22.75ZM12 2.75C6.9 2.75 2.75 6.9 2.75 12C2.75 17.1 6.9 21.25 12 21.25C17.1 21.25 21.25 17.1 21.25 12C21.25 6.9 17.1 2.75 12 2.75Z"
            fill="#7A8591"
          />
          <path
            d="M9.16986 15.5799C8.97986 15.5799 8.78986 15.5099 8.63986 15.3599C8.34986 15.0699 8.34986 14.5899 8.63986 14.2999L14.2999 8.63986C14.5899 8.34986 15.0699 8.34986 15.3599 8.63986C15.6499 8.92986 15.6499 9.40986 15.3599 9.69986L9.69986 15.3599C9.55986 15.5099 9.35986 15.5799 9.16986 15.5799Z"
            fill="#7A8591"
          />
          <path
            d="M14.8299 15.5799C14.6399 15.5799 14.4499 15.5099 14.2999 15.3599L8.63986 9.69986C8.34986 9.40986 8.34986 8.92986 8.63986 8.63986C8.92986 8.34986 9.40986 8.34986 9.69986 8.63986L15.3599 14.2999C15.6499 14.5899 15.6499 15.0699 15.3599 15.3599C15.2099 15.5099 15.0199 15.5799 14.8299 15.5799Z"
            fill="#7A8591"
          />
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div *ngFor="let submission of submissions">
        <div class="submission-details" *ngIf="submission?.SubmmisionLink">
          <div class="detailsInfo d-flex flex-column">
            <a
              [href]="
                'https://files.cherrypick.com/submissions/' +
                submission?.SubmmisionLink
              "
              target="_blank"
              class="submission-link"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
              >
                <circle cx="4" cy="4" r="4" fill="#16181D" />
              </svg>

              https://files.cherrypick.com/submissions/' +
              submission?.SubmmisionLink
            </a>

            <div class="user-info d-flex flex-row">
              <p *ngIf="submission?.FirstName">
                {{ submission?.FirstName + " " + submission?.LastName }}
              </p>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
              >
                <circle cx="4" cy="4" r="4" fill="#E2E4E9" />
              </svg>
              <p *ngIf="submission?.CreatedDate">
                {{ submission?.CreatedDate | date : "MMM dd, yyyy" }}
              </p>
            </div>
            <p class="available-space" *ngIf="submission?.AvailableSpace">
              Available Space:{{ submission?.AvailableSpace }} SF
            </p>
          </div>
          <div class="progress-bar-container">
            <div class="match-percentage">
              <div class="circle-progress">
                <svg viewBox="0 0 36 36" class="circle-svg">
                  <!-- Background path (gray) -->
                  <path
                    class="circle-bg"
                    d="M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831"
                    [style.stroke-dasharray]="getCircleProgressBackground(98)"
                  />
                  <!-- Foreground path (green) -->
                  <path
                    class="circle-fg"
                    d="M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831"
                    [style.stroke-dasharray]="getCircleProgress(98)"
                  />
                </svg>
                <div class="circle-label">
                  <span class="match">Match</span>
                  <span class="match-percentage"
                    >{{ submission?.Percentage }}%</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <br />
      </div>
    </div>
  </ng-template>
</div>

<ng-template #mailModal let-modal>
  <div class="modal-body" style="height: 90vh; overflow-y: auto">
    <div>
      <label for="">Email Subject</label>
      <div class="mail-body" [innerHTML]="openedEmail.Subject"></div>
    </div>
    <div class="date">
      {{ openedEmail.Date | date : "EEEE, MMMM d, y" }} at
      {{ openedEmail.Date | date : "h:mm a" }}
    </div>

    <div>
      <label for="">Email Body</label>
      <div class="mail-body" [innerHTML]="openedEmail.Body"></div>
    </div>
  </div>
</ng-template>
<ng-template #infoModal let-modal>
  <div class="modal-header score-header">
    <h5 class="modal-title score-pill">{{ score }}%</h5>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss()"
    ></button>
  </div>

  <div class="modal-body score-body">
    <div *ngIf="isLoadingInfo" class="loading">Loading...</div>

    <p class="conclusion-text">{{ conclusion }}</p>

    <div *ngIf="!isLoadingInfo">
      <div
        *ngIf="infoData; else noData"
        class="rationale-text"
        [innerHTML]="infoData"
      ></div>

      <ng-template #noData>
        <p>No rationale found.</p>
      </ng-template>
    </div>
  </div>
</ng-template>
