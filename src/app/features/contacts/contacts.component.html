<div class="contact-container">
  <!-- Header Section -->
  <div class="header">
    <div class="search-section">
      <div class="search-input-container">
        <svg
          class="search-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
        >
          <path
            d="M11.5 21.75C5.85 21.75 1.25 17.15 1.25 11.5C1.25 5.85 5.85 1.25 11.5 1.25C17.15 1.25 21.75 5.85 21.75 11.5C21.75 17.15 17.15 21.75 11.5 21.75ZM11.5 2.75C6.67 2.75 2.75 6.68 2.75 11.5C2.75 16.32 6.67 20.25 11.5 20.25C16.33 20.25 20.25 16.32 20.25 11.5C20.25 6.68 16.33 2.75 11.5 2.75Z"
            fill="#777199"
          />
          <path
            d="M21.9999 22.7504C21.8099 22.7504 21.6199 22.6804 21.4699 22.5304L19.4699 20.5304C19.1799 20.2404 19.1799 19.7604 19.4699 19.4704C19.7599 19.1804 20.2399 19.1804 20.5299 19.4704L22.5299 21.4704C22.8199 21.7604 22.8199 22.2404 22.5299 22.5304C22.3799 22.6804 22.1899 22.7504 21.9999 22.7504Z"
            fill="#777199"
          />
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Search Organizations..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
        />
      </div>
      <button class="add-new-btn" (click)="onAddNew()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add New
      </button>
    </div>

    <div class="action-buttons">
      <!-- <div class="dropdown-container" ngbDropdown>
          <button class="action-btn" ngbDropdownToggle>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="7" y1="12" x2="17" y2="12"></line>
                <line x1="10" y1="18" x2="14" y2="18"></line>
              </svg>
            Filter
          </button>
          <div ngbDropdownMenu class="dropdown-menu filter-menu">
            <h3>Share</h3>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="share" value="all" [(ngModel)]="shareFilter" (change)="onFilterChange()">
                <span class="radio-text">ALL</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="share" value="shared" [(ngModel)]="shareFilter" (change)="onFilterChange()">
                <span class="radio-text">Shared With Client</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="share" value="not-shared" [(ngModel)]="shareFilter" (change)="onFilterChange()">
                <span class="radio-text">Not Shared</span>
              </label>
            </div>

            <h3>Price</h3>
            <div class="range-inputs">
              <input type="text" placeholder="From" [(ngModel)]="priceFrom" (input)="onFilterChange()">
              <input type="text" placeholder="To" [(ngModel)]="priceTo" (input)="onFilterChange()">
            </div>

            <h3>Unit Size</h3>
            <div class="range-inputs">
              <input type="text" placeholder="From" [(ngModel)]="sizeFrom" (input)="onFilterChange()">
              <input type="text" placeholder="To" [(ngModel)]="sizeTo" (input)="onFilterChange()">
            </div>
          </div>
        </div> -->

      <div class="dropdown-container" ngbDropdown>
        <button class="action-btn" ngbDropdownToggle>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
          >
            <path
              d="M8.70844 6.22498C8.55011 6.22498 8.39175 6.16667 8.26675 6.04167L5.60841 3.38333L2.95008 6.04167C2.70841 6.28333 2.30841 6.28333 2.06675 6.04167C1.82508 5.8 1.82508 5.4 2.06675 5.15834L5.16677 2.05831C5.28344 1.94164 5.44175 1.875 5.60841 1.875C5.77508 1.875 5.93344 1.94164 6.05011 2.05831L9.15008 5.15834C9.39175 5.4 9.39175 5.8 9.15008 6.04167C9.02508 6.16667 8.86677 6.22498 8.70844 6.22498Z"
              fill="#777199"
            />
            <path
              d="M5.6084 18.125C5.26673 18.125 4.9834 17.8417 4.9834 17.5V2.5C4.9834 2.15833 5.26673 1.875 5.6084 1.875C5.95007 1.875 6.2334 2.15833 6.2334 2.5V17.5C6.2334 17.8417 5.95007 18.125 5.6084 18.125Z"
              fill="#777199"
            />
            <path
              d="M14.3999 18.1253C14.2333 18.1253 14.0749 18.0586 13.9582 17.942L10.8583 14.8419C10.6166 14.6003 10.6166 14.2003 10.8583 13.9586C11.0999 13.7169 11.4999 13.7169 11.7416 13.9586L14.3999 16.6169L17.0582 13.9586C17.2999 13.7169 17.6999 13.7169 17.9416 13.9586C18.1833 14.2003 18.1833 14.6003 17.9416 14.8419L14.8416 17.942C14.7249 18.0586 14.5583 18.1253 14.3999 18.1253Z"
              fill="#777199"
            />
            <path
              d="M14.3916 18.125C14.0499 18.125 13.7666 17.8417 13.7666 17.5V2.5C13.7666 2.15833 14.0499 1.875 14.3916 1.875C14.7333 1.875 15.0166 2.15833 15.0166 2.5V17.5C15.0166 17.8417 14.7416 18.125 14.3916 18.125Z"
              fill="#777199"
            />
          </svg>
          Sort
        </button>
        <div ngbDropdownMenu class="dropdown-menu sort-menu">
          <label class="radio-label">
            <input
              type="radio"
              name="sort"
              value="alphabetical"
              [(ngModel)]="sortBy"
              (change)="onSortChange()"
            />
            <span class="radio-text">Alphabetical</span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="sort"
              value="newest"
              [(ngModel)]="sortBy"
              (change)="onSortChange()"
            />
            <span class="radio-text">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              Newest to Oldest
            </span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="sort"
              value="oldest"
              [(ngModel)]="sortBy"
              (change)="onSortChange()"
            />
            <span class="radio-text">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              Oldest to Newest
            </span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="sort"
              value="status"
              [(ngModel)]="sortBy"
              (change)="onSortChange()"
            />
            <span class="radio-text">Status</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Skeleton Loading State -->
  <div class="skeleton-container" *ngIf="isLoading">
    <!-- Skeleton Contacts Grid -->
    <div class="skeleton-grid">
      <div class="skeleton-card" *ngFor="let i of [1, 2, 3, 4]">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-content">
          <div class="skeleton-name"></div>
          <div class="skeleton-title"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Real Content -->
  <div class="contacts-container" *ngIf="!isLoading">
    <!-- Contact Grid -->
    <div class="organization-grid">
      <div class="organization-card" *ngFor="let org of paginatedContacts">
        <h2 class="organization-title">{{ org.name }}</h2>

        <!-- If contacts exist, render 2-column grid -->
        <div *ngIf="org.contacts.length > 0">
          <div class="contact-card" *ngFor="let contact of org.contacts">
            <div class="contact-avatar">
              <img
                [src]="
                  'assets/Images/default-avatar-profile-icon-social-media-user-image-gray-avatar-icon-blank-profile-silhouette-vector-illustration_561158-3467.avif'
                "
                [alt]="contact.firstname"
              />
            </div>
            <div class="contact-info">
              <h3 class="contact-name">
                {{ contact.firstname }} {{ contact.lastname }}
              </h3>
              <div class="contact-title" *ngIf="contact.jobTitle">
                {{ contact.jobTitle }}
              </div>

              <div class="contact-details">
                <div class="contact-item" *ngIf="contact.email">
                  <span class="label">Email:</span>
                  <span class="value">{{ contact.email }}</span>
                </div>
                <div class="contact-item" *ngIf="contact.cellPhone">
                  <span class="label">Cell Phone:</span>
                  <span class="value">{{ contact.cellPhone }}</span>
                </div>
              </div>

              <div class="contact-badges">
                <span class="badge owner" *ngIf="contact.isOwner">Owner</span>
                <span
                  class="badge microsoft"
                  *ngIf="contact.accountMicrosoftLinked"
                  >Microsoft</span
                >
                <span class="badge google" *ngIf="contact.accountGoogleLinked"
                  >Google</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- If no contacts -->
        <div *ngIf="org.contacts.length === 0">
          <div class="contact-card empty">
            <div class="contact-info">
              <h3 class="contact-name">No contacts available</h3>
              <p class="contact-title">
                You can add a new contact using the button above.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination" *ngIf="totalItems > pageSize">
      <div class="pagination-controls">
        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          Previous
        </button>

        <button
          class="pagination-btn"
          [class.active]="currentPage === 1"
          (click)="onPageChange(1)"
          *ngIf="pages[0] > 1"
        >
          1
        </button>

        <span class="pagination-ellipsis" *ngIf="pages[0] > 2">...</span>

        <button
          *ngFor="let page of pages"
          class="pagination-btn"
          [class.active]="currentPage === page"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>

        <span
          class="pagination-ellipsis"
          *ngIf="pages[pages.length - 1] < totalPages - 1"
          >...</span
        >

        <button
          class="pagination-btn"
          [class.active]="currentPage === totalPages"
          (click)="onPageChange(totalPages)"
          *ngIf="pages[pages.length - 1] < totalPages"
        >
          {{ totalPages }}
        </button>

        <button
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)"
        >
          Next
        </button>
      </div>

      <div class="pagination-info-container">
        <span class="pagination-info">
          Showing {{ (currentPage - 1) * pageSize + 1 }} -
          {{ Math.min(currentPage * pageSize, totalItems) }} of
          {{ totalItems }} contacts
        </span>

        <div class="page-size-selector">
          <label for="pageSize">Show:</label>
          <select
            id="pageSize"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange()"
          >
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Contact Modal -->
  <div
    class="modal-overlay"
    *ngIf="showAddForm"
    (click)="onBackdropClick($event)"
  >
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Contact</h2>
        <button class="close-btn" (click)="closeAddForm()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <form class="contact-form" (ngSubmit)="saveContact()">
        <div class="form-group">
          <label for="firstname">First Name *</label>
          <input
            type="text"
            id="firstname"
            [(ngModel)]="newContact.firstname"
            name="firstname"
            required
            maxlength="10"
            placeholder="Enter first name"
          />
        </div>

        <div class="form-group">
          <label for="lastname">Last Name</label>
          <input
            type="text"
            id="lastname"
            [(ngModel)]="newContact.lastname"
            name="lastname"
            maxlength="5"
            placeholder="Enter last name"
          />
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="newContact.email"
            name="email"
            required
            placeholder="Enter email address"
          />
        </div>

        <div class="form-group">
          <label for="password">Password *</label>
          <input
            type="password"
            id="password"
            [(ngModel)]="newContact.password"
            name="password"
            required
            placeholder="Enter password"
          />
        </div>

        <div class="form-group">
          <label for="organizationId">Organization *</label>
          <select
            id="organizationId"
            [(ngModel)]="newContact.organizationId"
            name="organizationId"
            required
            class="form-control"
          >
            <option value="">Select Organization</option>
            <option *ngFor="let org of organizations" [value]="org.id">
              {{ org.name }}
            </option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="closeAddForm()">
            Cancel
          </button>
          <button
            type="submit"
            class="save-btn"
            [disabled]="
              !newContact.firstname ||
              !newContact.email ||
              !newContact.password ||
              !newContact.organizationId
            "
          >
            Save Contact
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
